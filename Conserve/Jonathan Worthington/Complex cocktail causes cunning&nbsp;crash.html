https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>
Complex cocktail causes cunning crash | 6guts</title>
<link rel="profile" href="https://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="https://s0.wp.com/wp-content/themes/pub/twentyten/style.css?ver=20190507" />
<link rel="pingback" href="https://6guts.wordpress.com/xmlrpc.php">
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s.pubmine.com' />
<link rel='dns-prefetch' href='//x.bidswitch.net' />
<link rel='dns-prefetch' href='//static.criteo.net' />
<link rel='dns-prefetch' href='//ib.adnxs.com' />
<link rel='dns-prefetch' href='//aax.amazon-adsystem.com' />
<link rel='dns-prefetch' href='//bidder.criteo.com' />
<link rel='dns-prefetch' href='//cas.criteo.com' />
<link rel='dns-prefetch' href='//gum.criteo.com' />
<link rel='dns-prefetch' href='//ads.pubmatic.com' />
<link rel='dns-prefetch' href='//gads.pubmatic.com' />
<link rel='dns-prefetch' href='//tpc.googlesyndication.com' />
<link rel='dns-prefetch' href='//ad.doubleclick.net' />
<link rel='dns-prefetch' href='//googleads.g.doubleclick.net' />
<link rel='dns-prefetch' href='//www.googletagservices.com' />
<link rel='dns-prefetch' href='//cdn.switchadhub.com' />
<link rel='dns-prefetch' href='//delivery.g.switchadhub.com' />
<link rel='dns-prefetch' href='//delivery.swid.switchadhub.com' />
<link rel='dns-prefetch' href='//a.teads.tv' />
<link rel='dns-prefetch' href='//prebid.media.net' />
<link rel='dns-prefetch' href='//adserver-us.adtech.advertising.com' />
<link rel='dns-prefetch' href='//fastlane.rubiconproject.com' />
<link rel='dns-prefetch' href='//prebid-server.rubiconproject.com' />
<link rel='dns-prefetch' href='//hb-api.omnitagjs.com' />
<link rel='dns-prefetch' href='//mtrx.go.sonobi.com' />
<link rel='dns-prefetch' href='//apex.go.sonobi.com' />
<link rel='dns-prefetch' href='//u.openx.net' />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Feed" href="https://6guts.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Comments Feed" href="https://6guts.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Complex cocktail causes cunning&nbsp;crash Comments Feed" href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s0.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1612197847h&ver=5.6.1"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s0.wp.com/_static/??-eJytUstuwyAQ/KFiZKuplEPVbwGzpcS8BEss/30WorZurLo+9II87Mx6dlg+RzYGj+CRSxs0i7Zo4zOfQ1JCZa5tkMJ2Y85P/C8uzlRaqM6uw0bhyhc/gRUIisWQ8QHtyayZIPMLYBTjxBra0D+5uhCUkDRVEvDruTt3A5fFWFW9N71MIi0842LhH/rgB7gjfZpqNYZYQkGmk1GHrTy0SAKN1/kX+SrAOgLduyiwMhwoI8CSbY97sjmShkkZE+TM6HSmONbm3T7A/ZrHIr/X4Z7UQW6bgrV/7poySgNtDxSqhskAJTlzBBfrNh0IQ0NgZIuyC/4HYO9WmLS/v3X96VNzYq1gFb251/6lH079+fQ8XG7nkUW+?cssminify=yes' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify {
	text-align:justify;
}
</style>
<style id='jetpack-global-styles-frontend-style-inline-css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??-eJxti8sKgCAQAH8oW6KHdoi+xcTUWF1pjX4/OnSIOg0DM3BmYSgVmwrEQ2Q8XEgMmbiIFXXYgb3eQ3IPa8Ncwf/FZIJGgeToLZ+peBstg+/AIS0a72COU9OPUg69atV2AWWKN+I=?cssminify=yes' type='text/css' media='all' />
<script id='jetpack_related-posts-js-extra'>
var related_posts_js_options = {"post_heading":"h4"};
</script>
<script id='wpcom-actionbar-placeholder-js-extra'>
var actionbardata = {"siteID":"14597269","siteName":"6guts","siteURL":"http:\/\/6guts.wordpress.com","icon":"<img alt='' src='https:\/\/s0.wp.com\/i\/logo\/wpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/twentyten","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2F6guts.wordpress.com%2F2016%2F12%2F09%2Fcomplex-cocktail-causes-cunning-crash%2F&signup_flow=account","themeURL":"","xhrURL":"https:\/\/6guts.wordpress.com\/wp-admin\/admin-ajax.php","nonce":"73a4d0c81a","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"db0032352c\" \/>","referer":"https:\/\/6guts.wordpress.com\/2016\/12\/09\/complex-cocktail-causes-cunning-crash\/","canFollow":"1","feedID":"913460","statusMessage":"","customizeLink":"https:\/\/6guts.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F12%2F09%2Fcomplex-cocktail-causes-cunning-crash%2F","postID":"466","shortlink":"https:\/\/wp.me\/pZfpP-7w","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/6guts.wordpress.com\/466","statsLink":"https:\/\/wordpress.com\/stats\/post\/466\/6guts.wordpress.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Twenty Ten","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/read\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 59 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2F6guts.wordpress.com%2F2016%2F12%2F09%2Fcomplex-cocktail-causes-cunning-crash%2F&signup_flow=account\">Log in now.<\/a>","stats":"Stats"}};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFzdEKwjAMBdAfMiurMPFB/Ja5xZLSpLVpEP9+HSiILz6FezmXuGeBJUtDaS6q43yjhGCKdQ69A5J7HqIeXHckS7IVdYfxYVhf7zMwyV8ETKHODb/x5zMblGSBRF3F1NEKJWv7SX115cs4jf548ufJxw1oVkW8'></script>
<link rel='stylesheet' id='all-css-0-2' href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1530132353h&cssminify=yes' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://6guts.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s0.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/" />
<link rel='shortlink' href='https://wp.me/pZfpP-7w' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F12%2F09%2Fcomplex-cocktail-causes-cunning-crash%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F12%2F09%2Fcomplex-cocktail-causes-cunning-crash%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Complex cocktail causes cunning crash" />
<meta property="og:url" content="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/" />
<meta property="og:description" content="I did a number of things for Perl 6 yesterday. It was not, however, hard to decide which of them to write up for the blog. So, let&#8217;s dig in. Horrible hiding heisenbugs It all started when I w…" />
<meta property="article:published_time" content="2016-12-09T00:02:33+00:00" />
<meta property="article:modified_time" content="2016-12-15T09:53:24+00:00" />
<meta property="og:site_name" content="6guts" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Complex cocktail causes cunning&nbsp;crash" />
<meta name="twitter:card" content="summary" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://6guts.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://6guts.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://6guts.wordpress.com/osd.xml" title="6guts" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<meta name="application-name" content="6guts" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Tales of Perl 6 guts hacking" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://6guts.wordpress.com/feed/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="description" content="I did a number of things for Perl 6 yesterday. It was not, however, hard to decide which of them to write up for the blog. So, let&#039;s dig in. Horrible hiding heisenbugs It all started when I was looking into this RT, reporting a segfault. It was filed a while ago, and I could&hellip;" />
		<script type="text/javascript">

			window.doNotSellCallback = function() {

				var linkElements = [
					'a[href="https://wordpress.com/?ref=footer_blog"]',
					'a[href="https://wordpress.com/?ref=footer_website"]',
					'a[href="https://wordpress.com/?ref=vertical_footer"]',
					'a[href^="https://wordpress.com/?ref=footer_segment_"]',
				].join(',');

				var dnsLink = document.createElement( 'a' );
				dnsLink.href = 'https://wordpress.com/advertising-program-optout';
				dnsLink.classList.add( 'do-not-sell-link' );
				dnsLink.rel = 'nofollow';
				dnsLink.style.marginLeft = '0.5em';
				dnsLink.textContent = 'Do Not Sell My Personal Information';

				var creditLinks = document.querySelectorAll( linkElements );

				if ( 0 === creditLinks.length ) {
					return false;
				}

				Array.prototype.forEach.call( creditLinks, function( el ) {
					el.insertAdjacentElement( 'afterend', dnsLink );
				});

				return true;
			};

		</script>
				<script type="text/javascript">
		function __ATA_CC() {var v = document.cookie.match('(^|;) ?personalized-ads-consent=([^;]*)(;|$)');return v ? 1 : 0;}
		var __ATA_PP = { pt: 1, ht: 0, tn: 'twentyten', amp: false, siteid: 8982, blogid: 14597269, consent: __ATA_CC()   };
		var __ATA = __ATA || {};
		__ATA.cmd = __ATA.cmd || [];
		__ATA.criteo = __ATA.criteo || {};
		__ATA.criteo.cmd = __ATA.criteo.cmd || [];
		
		</script>
		<script type="text/javascript">
		(function(){var g=Date.now||function(){return+new Date};function h(a,b){a:{for(var c=a.length,d="string"==typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]};function k(a,b,c){c=null!=c?"="+encodeURIComponent(String(c)):"";if(b+=c){c=a.indexOf("#");0>c&&(c=a.length);var d=a.indexOf("?");if(0>d||d>c){d=c;var e=""}else e=a.substring(d+1,c);a=[a.substr(0,d),e,a.substr(c)];c=a[1];a[1]=b?c?c+"&"+b:b:c;a=a[0]+(a[1]?"?"+a[1]:"")+a[2]}return a};var l=0;function m(a,b){var c=document.createElement("script");c.src=a;c.onload=function(){b&&b(void 0)};c.onerror=function(){b&&b("error")};a=document.getElementsByTagName("head");var d;a&&0!==a.length?d=a[0]:d=document.documentElement;d.appendChild(c)}function n(a){var b=void 0===b?document.cookie:b;return(b=h(b.split("; "),function(c){return-1!=c.indexOf(a+"=")}))?b.split("=")[1]:""}function p(a){return"string"==typeof a&&0<a.length}
		function r(a,b,c){b=void 0===b?"":b;c=void 0===c?".":c;var d=[];Object.keys(a).forEach(function(e){var f=a[e],q=typeof f;"object"==q&&null!=f||"function"==q?d.push(r(f,b+e+c)):null!==f&&void 0!==f&&(e=encodeURIComponent(b+e),d.push(e+"="+encodeURIComponent(f)))});return d.filter(p).join("&")}function t(a,b){a||((window.__ATA||{}).config=b.c,m(b.url))}var u=Math.floor(1E13*Math.random()),v=window.__ATA||{};window.__ATA=v;window.__ATA.cmd=v.cmd||[];v.rid=u;v.createdAt=g();var w=window.__ATA||{},x="s.pubmine.com";
		w&&w.serverDomain&&(x=w.serverDomain);var y="//"+x+"/conf",z=window.top===window,A=window.__ATA_PP&&window.__ATA_PP.gdpr_applies,B="boolean"===typeof A?Number(A):null,C=window.__ATA_PP||null,D=z?document.referrer?document.referrer:null:null,E=z?window.location.href:document.referrer?document.referrer:null,F,G=n("__ATA_tuuid");F=G?G:null;var H=window.innerWidth+"x"+window.innerHeight,I=n("usprivacy"),J=r({gdpr:B,pp:C,rid:u,src:D,ref:E,tuuid:F,vp:H,us_privacy:I?I:null},"",".");
		(function(a){var b=void 0===b?"cb":b;l++;var c="callback__"+g().toString(36)+"_"+l.toString(36);a=k(a,b,c);window[c]=function(d){t(void 0,d)};m(a,function(d){d&&t(d)})})(y+"?"+J);}).call(this);
		</script><link rel="amphtml" href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/amp/"><script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_gat._anonymizeIp']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script>
</head>

<body class="post-template-default single single-post postid-466 single-format-standard customizer-styles-applied single-author highlander-enabled highlander-light">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div id="branding" role="banner">
								<div id="site-title">
					<span>
						<a href="https://6guts.wordpress.com/" title="6guts" rel="home">6guts</a>
					</span>
				</div>
				<div id="site-description">Tales of Perl 6 guts hacking</div>

									<a class="home-link" href="https://6guts.wordpress.com/" title="6guts" rel="home">
						<img src="https://6guts.files.wordpress.com/2010/07/cropped-30141.jpg" width="940" height="198" alt="" />
					</a>
								</div><!-- #branding -->

			<div id="access" role="navigation">
								<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
				<div class="menu"><ul>
<li ><a href="https://6guts.wordpress.com/">Home</a></li><li class="page_item page-item-2"><a href="https://6guts.wordpress.com/about/">About</a></li>
<li class="page_item page-item-24"><a href="https://6guts.wordpress.com/interesting-papers/">Interesting Papers</a></li>
</ul></div>
			</div><!-- #access -->
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="https://6guts.wordpress.com/2016/12/01/taking-a-couple-of-steps-backwards-to-fix-a-gc-bug/" rel="prev"><span class="meta-nav">&larr;</span> Taking a couple of steps backwards to fix a GC&nbsp;bug</a></div>
					<div class="nav-next"><a href="https://6guts.wordpress.com/2017/03/16/considering-hyperrace-semantics/" rel="next">Considering hyper/race semantics <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-466" class="post-466 post type-post status-publish format-standard hentry category-uncategorized">
											<h2 class="entry-title"><a href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/" rel="bookmark">Complex cocktail causes cunning&nbsp;crash</a></h2>					
					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted on</span> <a href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/" title="1:02 AM" rel="bookmark"><span class="entry-date">December 9, 2016</span></a> <span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="https://6guts.wordpress.com/author/jnthnwrthngtn/" title="View all posts by jnthnwrthngtn">jnthnwrthngtn</a></span>					</div><!-- .entry-meta -->

					<div class="entry-content">
						<p>I did a number of things for Perl 6 yesterday. It was not, however, hard to decide which of them to write up for the blog. So, let&#8217;s dig in.</p>
<h3><a id="user-content-horrible-hiding-heisenbugs" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#horrible-hiding-heisenbugs"></a>Horrible hiding heisenbugs</h3>
<p>It all started when I was looking into <a href="https://rt.perl.org/Ticket/Display.html?id=128985">this RT</a>, reporting a segfault. It was filed a while ago, and I could not reproduce it. So, add a test and case closed? Well, not so fast. As I discussed <a href="https://6guts.wordpress.com/2016/12/01/taking-a-couple-of-steps-backwards-to-fix-a-gc-bug/">last week</a>, garbage collection happens when a thread fills up its nursery. Plenty of bugs only show up when the timing is just right (or is that just wrong?) What can influence when GC runs? How many allocations we&#8217;ve done. And what can influence that? Pretty much any change to the program being run, the compiler, or the environment. The two that most often have people tearing their hair out are:</p>
<ul>
<li>How many things the compiler allocates compiling the code. This is why even adding or removing comments can reveal and hide bugs. And, of course, changes to the compiler over time will make all kinds of differences, so the bug can appear or disappear from Rakudo commit to commit. Argh!</li>
<li>How many things are in the environment, because each one of them results in an allocation of a string at startup. So, yes, adding an environment variable to turn on a debugging feature can hide or show a problem. Running under a test harness that sticks something into the environment can do the very same. Eek!</li>
</ul>
<p>While GC-related issues are not the only cause of SEGVs, in such a simple piece of code using common features it&#8217;s far and away the most likely cause. So, to give myself more confidence that the bug truly was gone, I <a href="https://github.com/MoarVM/MoarVM/blob/8e24145dafe3551563bb5ef1997c437dd08afd6e/src/gc/collect.h#L4">adjusted the nursery size</a> to be just 32KB instead of 4MB, which causes GC to run much more often. This, of course, is a huge slowdown, but it&#8217;s good for squeezing out bugs.</p>
<p>And&#8230;no bug! So, in goes the test. Simples!</p>
<p>In even better news, it was lunch time. Well, actually, that was only sort of good news. A few days ago I cooked a rather nice chicken and berry pulao. It came out pretty good, but cooking 6 portions worth of it when I&#8217;m home alone for the week wasn&#8217;t so smart. I don&#8217;t want to see chicken pulao for a couple of months now. Anyway, while I was devouring some of my pulao mountain, I set off a spectest run on the 32KB nursery stress build of MoarVM, just to see if it showed up anything.</p>
<h3><a id="user-content-putrid-pointers" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#putrid-pointers"></a>Putrid pointers</h3>
<p>A couple of failures did, in fact, show up, one of them in <code>constant.t</code>. This rang a bell. I was sure somebody had a in the last couple of weeks reported a crash in that test file, which had then vanished. I checked in with the person who I vaguely recalled mentioning it and&#8230;sure enough, it was that very test file. In their normal test runs, the bug had long since vanished. I figured, having now got a reproduction of it, I should probably hunt it down right away. Otherwise, we&#8217;d probably end up playing &#8220;where&#8217;s Wally&#8221; with it for another month or ten.</p>
<p>So, how did the failure look?</p>
<pre><code>$ ./perl6-m -Ilib t/spec/S04-declarations/constant.rakudo.moar 
Segmentation fault (core dumped)
</code></pre>
<p>It actually segfaulted while <em>compiling</em> the test file. Sad! So, where?</p>
<pre><code>$ ./perl6-gdb-m -Ilib t/spec/S04-declarations/constant.rakudo.moar 
[boring output omitted]
Program received signal SIGSEGV, Segmentation fault.
0x0000000000000000 in ?? ()
</code></pre>
<p>That looks&#8230;ungood. That final line is meant to be a code location, which means something decided to tell the CPU to go execute code living at the NULL address. At this point, things could go two ways: the JIT spat out something terrible, or a function pointer somewhere was NULL. But which?</p>
<pre><code>(gdb) where
#0  0x0000000000000000 in ?? ()
#1  0x00007ffff78cacbc in MVM_coerce_smart_stringify (tc=0x6037c0, obj=0x605c10, res_reg=0x56624d8)
    at src/core/coerce.c:214
#2  0x00007ffff789dff4 in MVM_interp_run (tc=tc@entry=0x6037c0, initial_invoke=0x60ea80, 
    invoke_data=0x56624d8) at src/core/interp.c:827
#3  0x00007ffff7978b21 in MVM_vm_run_file (instance=0x603010, 
    filename=0x7fffffffe09f "/home/jnthn/dev/rakudo/perl6.moarvm") at src/moar.c:309
#4  0x000000000040108b in main (argc=9, argv=0x7fffffffdbc8) at src/main.c:192
</code></pre>
<p>Phew, it looks like the second case, given there&#8217;s no JIT entry stub on the stack. So, we followed a <code>NULL</code> function pointer. Really?</p>
<pre><code>(gdb) frame 1
#1  0x00007ffff78cacbc in MVM_coerce_smart_stringify (tc=0x6037c0, obj=0x605c10, res_reg=0x56624d8)
at src/core/coerce.c:214
214     ss = REPR(obj)-&gt;get_storage_spec(tc, STABLE(obj));
</code></pre>
<p>Yes, really. Presumably, that <code>get_storage_spec</code> is bogus. (I did a <code>p</code> to confirm it.) So, how is <code>obj</code> looking?</p>
<pre><code>(gdb) p *obj
$1 = {header = {sc_forward_u = {forwarder = 0x48000000000001, sc = {sc_idx = 1, idx = 4718592}, 
  st = 0x48000000000001}, owner = 6349760, flags = 0, size = 0}, st = 0x6d06c0}
</code></pre>
<p>Criminally corrupt; let me count the ways. For one, <code>6349760</code> looks like a very high thread ID for a program that&#8217;s only running a single thread (they are handed out sequentially). For two, <code>0</code> is not a valid object size. And for three, <code>idx</code> is just a nuts value too (even Rakudo&#8217;s CORE.setting isn&#8217;t made up of 4 million objects). So, where does this object live? Well, let&#8217;s try out last week&#8217;s handy object locator to figure out:</p>
<pre><code>(gdb) p MVM_gc_debug_find_region(tc, obj)
In tospace of thread 1
</code></pre>
<p>Well. Hmpfh. That&#8217;s actually an OK place for an object to be. Of course, the GC spaces swap often enough at this nursery size that a pointer could fail to be updated, point into <code>fromspace</code> after one GC run, not be used until a later GC run, and then come to point into some random bit of <code>tospace</code> again. How to test this hypothesis? Well, instead of 32768 bytes of nursery, what if I make it&#8230;well, 40000 maybe?</p>
<p>Here we go again:</p>
<pre><code>$ ./perl6-gdb-m -Ilib t/spec/S04-declarations/constant.rakudo.moar 
[trust me, this omitted stuff is boring]
Program received signal SIGSEGV, Segmentation fault.
0x00007ffff78b00db in MVM_interp_run (tc=tc@entry=0x6037c0, initial_invoke=0x0, invoke_data=0x563a450)
    at src/core/interp.c:2855
2855                    if (obj &amp;&amp; IS_CONCRETE(obj) &amp;&amp; STABLE(obj)-&gt;container_spec)
</code></pre>
<p>Aha! A crash&#8230;somewhere else. But where is <code>obj</code> this time?</p>
<pre><code>(gdb) p MVM_gc_debug_find_region(tc, obj)
In fromspace of thread 1
</code></pre>
<p>Hypothesis confirmed.</p>
<h3><a id="user-content-dump-diving" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#dump-diving"></a>Dump diving</h3>
<p>So&#8230;what now? Well, just turn on that wonder <code>MVM_GC_DEBUG</code> flag and the bug will make itself clear, of course. Alas, no. It didn&#8217;t trip a single one of the sanity checks added by enabling thee flag. So, what next?</p>
<p>The <code>where</code> in gdb tells us where in the C code we are. But what high level language code was MoarVM actually running at the time? Let&#8217;s dump the VM frame stack and find out:</p>
<pre><code>(gdb) p MVM_dump_backtrace(tc)
   at &lt;unknown&gt;:1  (./blib/Perl6/Grammar.moarvm:initializer:sym&lt;=&gt;)
 from gen/moar/stage2/QRegex.nqp:1378  (/home/jnthn/dev/MoarVM/install/share/nqp/lib/QRegex.moarvm:!protoregex)
 from &lt;unknown&gt;:1  (./blib/Perl6/Grammar.moarvm:initializer)
 from src/Perl6/Grammar.nqp:3140  (./blib/Perl6/Grammar.moarvm:type_declarator:sym&lt;constant&gt;)
 from gen/moar/stage2/QRegex.nqp:1378  (/home/jnthn/dev/MoarVM/install/share/nqp/lib/QRegex.moarvm:!protoregex)
 from &lt;unknown&gt;:1  (./blib/Perl6/Grammar.moarvm:type_declarator)
 from &lt;unknown&gt;:1  (./blib/Perl6/Grammar.moarvm:term:sym&lt;type_declarator&gt;)
 from gen/moar/stage2/QRegex.nqp:1378  (/home/jnthn/dev/MoarVM/install/share/nqp/lib/QRegex.moarvm:!protoregex)
 from src/Perl6/Grammar.nqp:3825  (./blib/Perl6/Grammar.moarvm:termish)
 from gen/moar/stage2/NQPHLL.nqp:886  (/home/jnthn/dev/MoarVM/install/share/nqp/lib/NQPHLL.moarvm:EXPR)
from src/Perl6/Grammar.nqp:3871  (./blib/Perl6/Grammar.moarvm:EXPR)
...
</code></pre>
<p>I&#8217;ve snipped out a good chunk of a fairly long stack trace. But look! We were parsing and compiling a constant at the time of the crash. That&#8217;s somewhat interesting, and explains why <code>constant.t</code> was a likely test file to show this bug up. But MoarVM has little idea about parsing or Perl 6&#8217;s idea of constants. Rather, something on that codepath of the compiler must run into a bug of sorts.</p>
<p>Looking at the location in <code>interp.c</code> the op being interpreted at the time was <code>decont</code>, which takes a value out of a <code>Scalar </code>container, if it happens to be in one. Combined with knowing what code we were in, I can invoke <code>moar --dump blib/Perl6/Grammar.moarvm</code>, and then locate the disassembly of <code>initializer:sym&lt;=&gt;</code>.</p>
<p>There were a few uses of the <code>decont</code> op in that function. All of them seemed to be on things looked up lexically or dynamically. So, I instrumented those ops with a <a href="https://github.com/MoarVM/MoarVM/commit/4d939e89808b61c817badb757504f1281efec322">fromspace check</a>. Re-compiled, and&#8230;</p>
<pre><code>(gdb) break MVM_panic
Breakpoint 1 at 0x7ffff78a19a0: file src/core/exceptions.c, line 779.
(gdb) r
Starting program: /home/jnthn/dev/MoarVM/install/bin/moar --execname=./perl6-gdb-m --libpath=/home/jnthn/dev/MoarVM/install/share/nqp/lib --libpath=/home/jnthn/dev/MoarVM/install/share/nqp/lib --libpath=. /home/jnthn/dev/rakudo/perl6.moarvm --nqp-lib=blib -Ilib t/spec/S04-declarations/constant.rakudo.moar
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".

Breakpoint 1, MVM_panic (exitCode=1, 
    messageFormat=0x7ffff799bc58 "Collectable %p in fromspace accessed") at src/core/exceptions.c:779
779 void MVM_panic(MVMint32 exitCode, const char *messageFormat, ...) {
(gdb) where
#0  MVM_panic (exitCode=1, messageFormat=0x7ffff799bc58 "Collectable %p in fromspace accessed")
    at src/core/exceptions.c:779
#1  0x00007ffff78ba657 in MVM_interp_run (tc=0x1, tc@entry=0x6037c0, initial_invoke=0x0, 
    invoke_data=0x604b80) at src/core/interp.c:374
#2  0x00007ffff7979071 in MVM_vm_run_file (instance=0x603010, 
    filename=0x7fffffffe09f "/home/jnthn/dev/rakudo/perl6.moarvm") at src/moar.c:309
#3  0x000000000040108b in main (argc=9, argv=0x7fffffffdbc8) at src/main.c:192
</code></pre>
<p>And what&#8217;s in <code>interp.c</code> around that line? The <code>getdynlex</code> op. That&#8217;s the one that is used to lookup things like <code>$*FOO</code> in Perl 6. So, a dynamic lexical lookup seemed to be handing back an outdated object. How could that happen?</p>
<h3><a id="user-content-interesting-idea-is-insufficient" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#interesting-idea-is-insufficient"></a>Interesting idea is insufficient</h3>
<p>My next idea was to see if I could catch the moment that something bad was put into the lexical. I&#8217;d already instrumented the obvious places with no luck. But&#8230;what if I could intercept every single VM register access and see if an object from <code>fromspace </code>was read? Hmmm&#8230; It turned out that <a href="https://github.com/MoarVM/MoarVM/commit/8dd2f63e1921134d8d7a2174cc910d6e2e62f411">I could make that happen</a> with a sufficiently cunning patch. I made it opt-in rather than the default for <code>MVM_GC_DEBUG</code> because it&#8217;s quite a slow-down. I&#8217;m sure that this will come in really useful for finding some GC bug some day. But for this bug? It was no direct help.</p>
<p>It was of some indirect help, however. It suggested strongly that at the time the lexical was set (actually, it turned out to be <code>$*LEFTSIGIL</code>), everything was valid. Somewhere between then and the lookup of it using the <code>getdynlex</code> op, things went bad.</p>
<h3><a id="user-content-cache-corruption" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#cache-corruption"></a>Cache corruption</h3>
<p>So what does <code>getdynlex</code> actually do? It checks if the current frame declares a lexical of the specified name. If so, it returns the value. If not, it looks in the caller for the value. If that fails, it goes on to the caller&#8217;s caller, until it runs out of stack to search and then gives up.</p>
<p>If that&#8217;s what it really did, then this bug would never have happened. But no, people actually want Perl 6 to run fast and stuff, so we can&#8217;t just implement the simplest possible thing and go chill. Instead, there&#8217;s a caching mechanism. And, as well all know, the two hardest problems in computer science are cache invalidation and cache invalidation.</p>
<p>The caching is relatively simple: each frame has slots for sticking a name, register pointer, and type in it.</p>
<pre><code>MVMString   *dynlex_cache_name;
MVMRegister *dynlex_cache_reg;
MVMuint16    dynlex_cache_type;
</code></pre>
<p>When <code>getdynlex</code> finds something the slow way, it then looks down the stack again and finds a frame with an empty <code>dynlex_cache_name</code>. It then sticks the name of dynamic lexical into the <code>name</code> slot, a pointer to the MoarVM lexical into the <code>reg</code> slot, and what type of lexical it was (native int, native num, object, etc.) into the <code>type</code> slot. The most interesting of these is the <code>reg</code> slot. The <code>MVMRegister</code> type is actually a union of different types that we may store in a register or lexical. We re-use the union for registers that live while the frame is on the callstack and lexicals that may need to live longer thanks to closures. So, each frame as two arrays of these:</p>
<pre><code>MVMRegister *env;   /* The lexical environment */
MVMRegister *work;  /* Working space that dies with the frame */
</code></pre>
<p>And so the <code>dynlex_cache_reg</code> ends up pointing to <code>env</code> somewhere in the frame that we found the lexical in.</p>
<p>So, the big question: was the caching to blame? I <a href="https://github.com/MoarVM/MoarVM/commit/22281b63f9ca915911a2bde09b0c298f04be0cc3">shoved in a way to disable it</a> and&#8230;the bug vanished.</p>
<p>Note by this point we&#8217;re up to two pieces that contribute to the bug: the GC and the dynamic lexical cache. The thing is, the dynamic lexical cache is used very heavily. My gut feeling told me there must be at least one more factor at play here.</p>
<h3><a id="user-content-suspicious-specialization" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#suspicious-specialization"></a>Suspicious specialization</h3>
<p>So, what could the other factor be? I re-enabled the cache, verified the crash came back, and then stuck <code>MVM_SPESH_DISABLE=1 </code>into the environment. And&#8230;no bug. So, it appeared that dynamic optimization was somehow involved too. That&#8217;s the magic that looks at what types actually show up at runtime, and compiles specialized versions of the code that fast-paths a bunch of operations based on that (this <em>specialization</em> being where the name &#8220;spesh&#8221; comes from). Unfortunately, <code>MVM_SPESH_DISABLE</code> is a rather blunt instrument. It disables a huge range of things, leaving a massive surface area to consider for the bug. Thankfully, there are some alternative environment variables that just turn off parts of spesh.</p>
<p>First, I tried <code>MVM_JIT_DISABLE=1</code>, which results in spesh interpreting the specialized version of the code rather than turning it into machine code to remove the interpreter overhead. The bug remained.</p>
<p>Next, I tried <code>MVM_SPESH_OSR_DISABLE</code>, which disables On Stack Replacement. This is a somewhat fiddly optimization that detects hot loops as they are being interpreted, pauses execution, produces an optimized version of the code, and then recalculates the program counter so it points to the appropriate point in the optimize code and continues execution. Basically, the interpreter gets the code it&#8217;s executing replaced under it &#8211; perhaps with machine code, which the interpreter is instructed to jump into immediately. Since this also fiddles with frames &#8220;in flight&#8221;, it seemed like a good candidate. But&#8230;nope. Bug remained.</p>
<p>Finally, I tried <code>MVM_SPESH_INLINE_DISABLE</code>, which disables inlining. That&#8217;s where we spot a call to a relatively small subroutine or method, and just replace the call with the code of the sub or method itself, saving the cost of setting up callframes. And&#8230;bug vanished!</p>
<p>So, inlining was apparently a factor too. The trouble is, that also didn&#8217;t seem to add up to an obvious bug. Consider:</p>
<pre><code>sub foo($a) {
    bar($a);
}
sub bar($b) {
    my $c = $b + 6;
    $c * 6
}
</code></pre>
<p>Imagine that <code>bar</code> was to be inlined into <code>foo</code>. Normally they&#8217;d have lexical slots in <code>-&gt;env</code> as follows:</p>
<pre><code>A:  | $_ | $! | $/ | $a |
B:  | $_ | $! | $/ | $b | $c |
</code></pre>
<p>The environment for the frame <code>inline(A, B)</code> would look like:</p>
<pre><code>inline(A, B):  | $_ | $! | $/ | $a | $_ | $! | $/ | $b | $c |
                \---- from A ----/  \------- from B -------/
</code></pre>
<p>Now, it&#8217;s easy to imagine various bugs that could arise in the <em>initial</em> lookup of a dynamic lexical in such a frame. Indeed, the dynamic lexical lookup code actually has two bunches of code that deal with such frames, one in the case the specialized code is being interpreted and one in the case where it has been JIT compiled. But by the time we are hitting the cache, there&#8217;s nothing smart going on at all: it&#8217;s just a cheap pointer deference.</p>
<h3><a id="user-content-dasturdly-deoptimization" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#dasturdly-deoptimization"></a>Dastardly deoptimization</h3>
<p>So, it seems we need a <em>fourth</em> ingredient to explain the bug. By now, I had a pretty good idea what it was. MoarVM doesn&#8217;t just to optimizations based on properties it can prove will always hold. It can also do speculative optimization based on properties that it expects will probably hold up. For example, suppose we have:</p>
<pre><code>sub foo($a, $b) {
    $b.some-huge-complex-call($a);
    return $a.Str;
}
</code></pre>
<p>Imagine we&#8217;re generating a specialization of this routine for the case <code>$a</code> is an object of type <code>Product</code>. The <code>Str</code> method is tiny, so we go ahead and inline it. However, <code>some-huge-complex-call</code> takes all kinds of code paths. We can&#8217;t be sure, from our analysis, that at some point it won&#8217;t mix in to the object in <code>$a</code>. What if it mixes in a role that has an alternate <code>Str</code> method? Our inlining would break stuff! We&#8217;d end up calling the <code>Product.Str</code> method, not the one from the mixin.</p>
<p>One reaction is to say &#8220;well, we&#8217;ll just not ever optimize stuff unless we can be REALLY sure&#8221;, which is either hugely limiting or relies on much more costly analyses. The other path, which MoarVM does, is to say &#8220;eh, let&#8217;s just assume mixins won&#8217;t happen, and if they do, we&#8217;ll fix things <em>then</em>!&#8221; The process of fixing things up is called deoptimization. We walk the call stack, rewriting return addresses to point to the original interpreted code instead of the optimized version of the code.</p>
<p>But what, you might wonder, do we do if there&#8217;s a frame on the stack that is actually the result of an inlining operation? What if we&#8217;re in the code that resulted from <code>inline(A,B)</code>, in the bit that corresponds to the code of <code>B</code>? Well, we have to perform &#8211; you guessed it &#8211; uninlining! The composite call frame has to be dissected, and the call stack rewritten to look like it would have if we&#8217;d been running the original interpreted code. To do this, we&#8217;d create a call frame for <code>B</code>, complete with space for its lexicals, and copy the lexicals from <code>inline(A,B)</code> that belong to <code>B</code> into that new buffer.</p>
<p>The code that does this is one of the very few parts of MoarVM that frightens me.</p>
<p>For good reason, it turns out. This deoptimization, together with uninlining, was the final ingredient needed for the bug. Here&#8217;s what happened:</p>
<ol>
<li>The method <code>EXPR</code> in <code>Perl6::Grammar</code> was inlined into one of its callers. This <code>EXPR</code> method declares a <code>$*LEFTSIGIL </code>variable.</li>
<li>While parsing the constant, the <code>$*LEFTSIGIL</code> is assigned to the sigil of the constant being declared, if it has one (so, in <code>constant $a = 42</code> it would be set to <code>$</code>).</li>
<li>Something does a lookup of <code>$*LEFTSIGIL</code>. It is located and cached. The cache entry points into a region of the <code>-&gt;env</code> of the frame that inlined, and thus incorporated, the lexical environment of <code>EXPR</code>.</li>
<li>At some point, a mixin happens, causing a deoptimization of the call stack. The frame that inlined <code>EXPR</code> gets pulled apart. A new <code>EXPR</code> frame comes to exist, with the lexicals that used to live in the composite frame copied into them. Execution continues.</li>
<li>A GC happens. The object containing the <code>$</code> substring moves. The new <code>EXPR</code> frame&#8217;s lexical environment is updated.</li>
<li>Another lookup of <code>$*LEFTSIGIL</code> happens. It hits the cache. The cache, however, still points to the place the lexical used to live in the composite frame. This memory has not been freed, because the first part of it is still being used. However, the GC no longer cares about its contents because that content is unreachable. Therefore, it contains an outdated pointer, thus leading to accessing memory that&#8217;s being used for something else entirely by that point, leading to the eventual segmentation fault.</li>
</ol>
<p>The most natural fix was to <a href="https://github.com/MoarVM/MoarVM/commit/e674686fe9c21b907e68abdd8d78c6308726e0f3">invalidate the cache</a> during deoptimization.</p>
<h3><a id="user-content-lessons-learned" class="anchor" href="https://gist.github.com/jnthn/c10d8f30b23a8bc74418d10388cc22e0#lessons-learned"></a>Lessons learned</h3>
<p>The bug I wrote up last week was thanks to a comparatively simple oversight made within the scope of a few lines of a single C function. While this one could be fixed with a small amount of code added in a single file, the segfault arose from the interaction of four distinct features existing in MoarVM:</p>
<ul>
<li>Garbage collection</li>
<li>Dynamic lexical lookup caching</li>
<li>Inlining</li>
<li>Deoptimization</li>
</ul>
<p>Even when a segfault was not produced, thanks to &#8220;lucky&#8221; GC timing, the bug would lead to reading of stale data. It just so turned out that the data wasn&#8217;t ever stale enough in reality to break things on this particular code path.</p>
<p>All of garbage collection, inlining, and deoptimization are fairly complicated. By contrast, the dynamic lexical lookup cache is fairly easy. Interestingly, it was the addition of this easy feature that introduced the bug &#8211; not because the code that was added was wrong, but rather because it did something that some other far flung piece of code &#8211; the deoptimizer &#8211; had quietly relied on not happening.</p>
<p>So, what might be learned for the future?</p>
<p>The most immediate practical learning is that taking interior pointers into mutable data structures is risky. In this case, that data structure was a composite lexical environment, that later got taken apart. Conceptually, the environment was resized and the interior pointer was off the end of the new size. This suggests either providing a safe way to acquire such a reference, or an alternative design for the dynamic lexical cache to avoid needing to do so.</p>
<p>Looking at the bigger picture, this is all about managing complexity. Folks who work with me tend to observe I worry a good bit about loose coupling, to the degree that I&#8217;m much more hesitant than the typical developer when it comes to code re-use. Acutely aware that re-use means use, and use means dependency, and dependency means coupling, I tend to want things to prove they really are the same thing rather than just looking like they might be the same thing. MoarVM reflects this in various ways: to the degree I can, I try to organize it as a collection of parts that either keep themselves very much to themselves, or that collaborate over a small number of very stable data structures. One of the reasons Git works architecturally is because while all the components of it are messing with the same data structure, it&#8217;s a very stable and well-understood data structure.</p>
<p>In this bug, <code>MVMFrame</code> is the data structure in question. A whole load of components know about it and work with it because &#8211; so the theory went &#8211; it&#8217;s one of the key stable data structures of the VM. Contrast it with the design of things like the Unicode normalizer or the fixed size allocator, which nothing ever pokes into directly. These are likely to want to evolve over time to choose smarter data structures, or to get extra bits of state to cope with Unicode&#8217;s latest and greatest emoji boundary specification. Therefore, all work with them is hidden nicely behind an API.</p>
<p>In reality, <code>MVMFrame</code> has grown to contain quite a fair few things as MoarVM has evolved. At the same time, its treated as a known quantity by lots of parts of the codebase. This is only sustainable if every addition to <code>MVMFrame</code> is followed by considering how every other part of the VM that interacts with it will be affected by the change, and making compensating changes to those components. In this case, the addition of the dynamic lexical cache into the frame data structure was not accompanied by sufficient analysis of which other parts of the VM may need compensating changes.</p>
<p>The bug I wrote up last week isn&#8217;t really the kind that causes an architect a headache. It was a localized coding slip-up that could happen to anyone on a bad day. It&#8217;s a pity we didn&#8217;t catch it in code review, but code reviewers are also human. This bug, by contrast, arose as a result of the complexity of the VM &#8211; or, more to the point, insufficient management of that complexity. And no, I&#8217;m not beating myself up over this. But, as MoarVM architect, this is exactly the type of bug that catches my eye, and causes me to question assumptions. In the immediate, it tells me what kinds of patches I should be reviewing really carefully. In the longer run, the nature of the <code>MVMFrame</code> data structure and its level of isolation from the rest of the codebase deserves some questioning.</p>
<div id="atatags-370373-6027b8c42f0e9">
        <script type="text/javascript">
            __ATA.cmd.push(function() {
                __ATA.initVideoSlot('atatags-370373-6027b8c42f0e9', {
                    sectionId: '370373',
                    format: 'inread'
                });
            });
        </script>
    </div>			<div id="atatags-26942-6027b8c42f14b"></div>
			
			<script>
				__ATA.cmd.push(function() {
					__ATA.initDynamicSlot({
						id: 'atatags-26942-6027b8c42f14b',
						location: 120,
						formFactor: '001',
						label: {
							text: 'Advertisements',
						},
						creative: {
							reportAd: {
								text: 'Report this ad',
							},
							privacySettings: {
								text: 'Privacy',
								
							}
						}
					});
				});
			</script><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-466" class="share-twitter sd-button share-icon" href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-466" class="share-facebook sd-button share-icon" href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-14597269-466-6027b8c42f732' data-src='//widgets.wp.com/likes/index.html?ver=20200826#blog_id=14597269&amp;post_id=466&amp;origin=6guts.wordpress.com&amp;obj_id=14597269-466-6027b8c42f732' data-name='like-post-frame-14597269-466-6027b8c42f732'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>											</div><!-- .entry-content -->

		
						<div class="entry-utility">
							This entry was posted in <a href="https://6guts.wordpress.com/category/uncategorized/" rel="category tag">Uncategorized</a>. Bookmark the <a href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/" title="Permalink to Complex cocktail causes cunning&nbsp;crash" rel="bookmark">permalink</a>.													</div><!-- .entry-utility -->
					</div><!-- #post-466 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="https://6guts.wordpress.com/2016/12/01/taking-a-couple-of-steps-backwards-to-fix-a-gc-bug/" rel="prev"><span class="meta-nav">&larr;</span> Taking a couple of steps backwards to fix a GC&nbsp;bug</a></div>
					<div class="nav-next"><a href="https://6guts.wordpress.com/2017/03/16/considering-hyperrace-semantics/" rel="next">Considering hyper/race semantics <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
			<div id="comments">


			<h3 id="comments-title">
			3 Responses to <em>Complex cocktail causes cunning&nbsp;crash</em>			</h3>


			<ol class="commentlist">
						<li class="comment byuser comment-author-smls2 even thread-even depth-1 highlander-comment" id="li-comment-2790">
		<div id="comment-2790">
			<div class="comment-author vcard">
				<img alt='' src='https://2.gravatar.com/avatar/83ece50530e2901f15da5d0e755deb46?s=40&#038;d=identicon&#038;r=G' class='avatar avatar-40' height='40' width='40' />				<cite class="fn"><a href='http://smls2.wordpress.com' rel='external nofollow ugc' class='url'>smls</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->

				
				
			<div class="comment-meta commentmetadata"><a href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/#comment-2790">
				December 9, 2016 at 3:05 PM</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>Couldn&#8217;t the whole recursive lookup of dynamic variables be avoided, by having a thread-global stash for them and installing clean-up code at the end of the relevant blocks (akin to how  <code>temp </code> works)?</p>
<p>For example:</p>
<pre><code>
    f1;

    sub f1 {
        my $*x = 5;   # add $*x to the global stash, with value 5
        ...
        f2;
        ...
    }                 # at end of the scope, remove $*x from stash

    sub f2 {
        my $*x = 42;  # set value of $*x in the stash to 42, and
                      # store the prior value somewhere in the frame
        ...
        
    }                 # at end of the scope, reinstate prior value
 </code></pre>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/?replytocom=2790#respond' data-commentid="2790" data-postid="466" data-belowelement="comment-2790" data-respondelement="respond" data-replyto="Reply to smls" aria-label='Reply to smls'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

				<ul class="children">
		<li class="comment byuser comment-author-jnthnwrthngtn bypostauthor odd alt depth-2 highlander-comment" id="li-comment-2791">
		<div id="comment-2791">
			<div class="comment-author vcard">
				<img alt='' src='https://2.gravatar.com/avatar/5999d5d26089eb4019867dc7705c41a9?s=40&#038;d=identicon&#038;r=G' class='avatar avatar-40' height='40' width='40' />				<cite class="fn"><a href='https://6guts.wordpress.com' rel='external nofollow ugc' class='url'>jnthnwrthngtn</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->

				
				
			<div class="comment-meta commentmetadata"><a href="https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/#comment-2791">
				December 9, 2016 at 3:50 PM</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>An approach along these lines could be made to work. However, it introduces at least one new coupling, contains a subtle bug if we were to implement it exactly as stated here, and makes a different performance trade-off.</p>
<p>The most immediate coupling that comes to mind is that the taking of continuations would have to get be aware of said stash and sync it up on both the taking of the continuation and the invocation of the continuation.</p>
<p>The subtle bug lies in the confusion of symbol and value. Symbols can be rebound to new values at any time, so if our stash pointed to values it would easily become outdated. Worse, thanks to constructs like `CALLER` (not to mention the existence of continuations), it&#8217;s possible for a dynamic lexical further down the stack than the currently visible value to be changed. These mean that the global stash and the temporary to re-instate would both need a level of indirection, so they point to the storage location of the lexical and can always read the most recently bound value living there. Unfortunately, I think that means that this scheme would have been every bit as vulnerable to the deopt bug as the current one.</p>
<p>This scheme does have the obvious performance benefit of not having to walk the caller chain. It comes with its drawbacks too. As already noted, the taking of continuations would likely become a little more costly due to the extra sync-up work; this would impact gather/take performance. For another, this imposes extra costs on callframe construction/teardown for any frame that declares a `my $*FOO`, even if it is never looked up. It would also lead to any frame declaring such a symbol as being ineligible for inlining (all frames that declare exit handlers today cannot be inlined; it&#8217;s not impossible to lift that restriction, but it&#8217;s not trivial either&#8230;just think about the new interaction between inlining and stack unwinding that arises).</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='https://6guts.wordpress.com/2016/12/09/complex-cocktail-causes-cunning-crash/?replytocom=2791#respond' data-commentid="2791" data-postid="466" data-belowelement="comment-2791" data-respondelement="respond" data-replyto="Reply to jnthnwrthngtn" aria-label='Reply to jnthnwrthngtn'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

				</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="post pingback">
		<p>Pingback: <a href='https://p6weekly.wordpress.com/2016/12/12/2016-50-highlighting-profilesql/' rel='external nofollow ugc' class='url'>2016.50 Highlighting &amp; ProfileSQL | Weekly changes in and around Perl 6</a></p>
				</li><!-- #comment-## -->
			</ol>


	

	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2016/12/09/complex-cocktail-causes-cunning-crash/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://6guts.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"><input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="d7e6913b3a" /><input type="hidden" name="_wp_http_referer" value="/2016/12/09/complex-cocktail-causes-cunning-crash/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">
	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" class="nascar-signin-link"
                   title="Login via Guest">
									</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" class="nascar-signin-link"
                   title="Login via WordPress.com">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg>				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2F6guts.wordpress.com&#038;color_scheme=light" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" class="nascar-signin-link"
                   title="Login via Twitter">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg>				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" class="nascar-signin-link"
                   title="Login via Facebook">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg>				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url" value="" /></div>
				</div>
			</div>
			
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
						<p class="comment-form-posting-as pa-wordpress">
			<strong></strong>
			You are commenting using your WordPress.com account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
						<p class="comment-form-posting-as pa-googleplus">
			<strong></strong>
			You are commenting using your Google account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" x="0px" y="0px" viewBox="0 0 60 60" ><path fill="#519bf7" d="M56.3,30c0,-1.6 -0.2,-3.4 -0.6,-5h-3.1H42.2H30v10.6h14.8C44,39.3 42,42 39.1,43.9l8.8,6.8C53,46 56.3,39 56.3,30z" /><path fill="#3db366" d="M30,57.5c6.7,0 13.1,-2.4 17.9,-6.8l-8.8,-6.8c-2.5,1.6 -5.6,2.4 -9.1,2.4c-7.2,0 -13.3,-4.7 -15.4,-11.2l-9.3,7.1C9.8,51.3 19.1,57.5 30,57.5z" /><path fill="#fdc600" d="M5.3,42.2l9.3,-7.1c-0.5,-1.6 -0.8,-3.3 -0.8,-5.1s0.3,-3.5 0.8,-5.1l-9.3,-7.1C3.5,21.5 2.5,25.6 2.5,30S3.5,38.5 5.3,42.2z" /><path fill="#f15b44" d="M40.1,17.4l8,-8C43.3,5.1 37,2.5 30,2.5C19.1,2.5 9.8,8.7 5.3,17.8l9.3,7.1c2.1,-6.5 8.2,-11.1 15.4,-11.1C33.9,13.7 37.4,15.1 40.1,17.4z" /></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
						<p class="comment-form-posting-as pa-twitter">
			<strong></strong>
			You are commenting using your Twitter account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
						<p class="comment-form-posting-as pa-facebook">
			<strong></strong>
			You are commenting using your Facebook account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function () {

	function hide( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.setProperty( 'display', 'none' );
		}
	}

	function show( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.removeProperty( 'display' );
		}
	}

	var input = document.createElement( 'input' );
	var comment = document.querySelector( '#comment' );

	if ( input && comment && 'placeholder' in input ) {
		var label = document.querySelector( '.comment-textarea label' );
		if ( label ) {
			var text = label.textContent;
			label.parentNode.removeChild( label );
			comment.setAttribute( 'placeholder', text );
		}
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	hide( '#comment-form-identity' );
	hide( '#comment-form-subscribe' );
	hide( '#commentform .form-submit' );

	if ( comment ) {
		comment.style.height = '10px';

		var handler = function () {
			comment.style.height = HighlanderComments.initialHeight + 'px';
			show( '#comment-form-identity' );
			show( '#comment-form-subscribe' );
			show( '#commentform .form-submit' );
			HighlanderComments.resizeCallback();

			comment.removeEventListener( 'focus', handler );
		};

		comment.addEventListener( 'focus', handler );
	}
}

if ( document.readyState !== 'loading' ) {
	highlander_expando_javascript();
} else {
	if ( typeof window.jQuery === 'function' ) {
		// Use jQuery's `ready` if available.
		// This solves some scheduling issues between this script and the main highlander script.
		jQuery( document ).ready( highlander_expando_javascript );
	} else {
		// If not available, add a vanilla event listener.
		document.addEventListener( 'DOMContentLoaded', highlander_expando_javascript );
	}
}

</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p><p class="post-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog"  style="display: inline;">Notify me of new posts via email.</label></p></div>




<p class="form-submit"><input name="submit" type="submit" id="comment-submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='466' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="55e1ef938d" /></p>
<input type="hidden" name="genseq" value="1613215940" />
<input type="hidden" id="ak_js" name="ak_js" value="166"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	<div style="clear: both"></div><p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div><!-- #comments -->

	
			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
						<ul class="xoxo">

<li id="search-2" class="widget-container widget_search"><form role="search" method="get" id="searchform" class="searchform" action="https://6guts.wordpress.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></li>
		<li id="recent-posts-2" class="widget-container widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="https://6guts.wordpress.com/2020/10/05/taking-a-break-from-raku-core-development/">Taking a break from Raku core&nbsp;development</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2019/01/02/my-perl-6-wishes-for-2019/">My Perl 6 wishes for&nbsp;2019</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/">Speeding up object&nbsp;creation</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/09/29/eliminating-unrequired-guards/">Eliminating unrequired guards</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/09/28/faster-box-unbox-and-int-operations/">Faster box/unbox and Int&nbsp;operations</a>
									</li>
					</ul>

		</li><li id="recent-comments-2" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3>				<table class="recentcommentsavatar" cellspacing="0" cellpadding="0" border="0">
					<tr><td title="2019.01 Wishes for 2019 | Weekly changes in and around Perl 6" class="recentcommentsavatartop" style="height:48px; width:48px;"><a href="https://p6weekly.wordpress.com/2019/01/08/2019-01-wishes-for-2019/" rel="nofollow"></a></td><td class="recentcommentstexttop" style=""><a href="https://p6weekly.wordpress.com/2019/01/08/2019-01-wishes-for-2019/" rel="nofollow">2019.01 Wishes for 2&hellip;</a> on <a href="https://6guts.wordpress.com/2019/01/02/my-perl-6-wishes-for-2019/#comment-6005">My Perl 6 wishes for&nbsp;2019</a></td></tr><tr><td title="hobbified (@hobbified)" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://twitter.com/hobbified" rel="nofollow"><img alt='' src='https://i1.wp.com/pbs.twimg.com/profile_images/67477518/dr_haas_normal.jpg?resize=48%2C48' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="http://twitter.com/hobbified" rel="nofollow">hobbified (@hobbifie&hellip;</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5966">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="Alex" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://gravatar.com/kaokun" rel="nofollow"><img alt='' src='https://0.gravatar.com/avatar/6428904bea03ecf54d864d2bf574a3a2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="http://gravatar.com/kaokun" rel="nofollow">Alex</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5913">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="jnthnwrthngtn" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="https://6guts.wordpress.com" rel="nofollow"><img alt='' src='https://2.gravatar.com/avatar/5999d5d26089eb4019867dc7705c41a9?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="https://6guts.wordpress.com" rel="nofollow">jnthnwrthngtn</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5907">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="Alex" class="recentcommentsavatarend" style="height:48px; width:48px;"><img alt='' src='https://0.gravatar.com/avatar/6428904bea03ecf54d864d2bf574a3a2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstextend" style="">Alex on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5896">Speeding up object&nbsp;creati&hellip;</a></td></tr>				</table>
				</li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href='https://6guts.wordpress.com/2020/10/'>October 2020</a></li>
	<li><a href='https://6guts.wordpress.com/2019/01/'>January 2019</a></li>
	<li><a href='https://6guts.wordpress.com/2018/10/'>October 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/09/'>September 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/07/'>July 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/06/'>June 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/03/'>March 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/01/'>January 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2017/11/'>November 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/09/'>September 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/08/'>August 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/07/'>July 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/06/'>June 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/05/'>May 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/04/'>April 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/03/'>March 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2016/12/'>December 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/11/'>November 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/08/'>August 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/07/'>July 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/06/'>June 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/04/'>April 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/03/'>March 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/02/'>February 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/01/'>January 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2015/12/'>December 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/11/'>November 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/10/'>October 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/09/'>September 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/08/'>August 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/07/'>July 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/06/'>June 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/05/'>May 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/04/'>April 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2014/06/'>June 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2014/04/'>April 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2014/01/'>January 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2013/12/'>December 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/10/'>October 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/09/'>September 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/08/'>August 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/07/'>July 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/05/'>May 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/04/'>April 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/02/'>February 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/01/'>January 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2012/11/'>November 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/10/'>October 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/09/'>September 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/08/'>August 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/07/'>July 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/06/'>June 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/05/'>May 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/04/'>April 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/03/'>March 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/02/'>February 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/01/'>January 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2011/11/'>November 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/10/'>October 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/09/'>September 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/08/'>August 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/07/'>July 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/06/'>June 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/05/'>May 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/04/'>April 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/02/'>February 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/01/'>January 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2010/11/'>November 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/10/'>October 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/09/'>September 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/08/'>August 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/07/'>July 2010</a></li>
			</ul>

			</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>
			<ul>
					<li class="cat-item cat-item-1"><a href="https://6guts.wordpress.com/category/uncategorized/">Uncategorized</a>
</li>
			</ul>

			</li><li id="meta-2" class="widget-container widget_meta"><h3 class="widget-title">Meta</h3>
		<ul>
			<li><a href="https://wordpress.com/start?ref=wplogin">Register</a></li>			<li><a href="https://6guts.wordpress.com/wp-login.php">Log in</a></li>
			<li><a href="https://6guts.wordpress.com/feed/">Entries feed</a></li>
			<li><a href="https://6guts.wordpress.com/comments/feed/">Comments feed</a></li>

			<li><a href="https://wordpress.com/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.com</a></li>
		</ul>

		</li>			<div id="atatags-286348-6027b8c4380d1"></div>
			
			<script>
				__ATA.cmd.push(function() {
					__ATA.initDynamicSlot({
						id: 'atatags-286348-6027b8c4380d1',
						location: 140,
						formFactor: '003',
						label: {
							text: 'Advertisements',
						},
						creative: {
							reportAd: {
								text: 'Report this ad',
							},
							privacySettings: {
								text: 'Privacy',
								
							}
						}
					});
				});
			</script>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="site-info">
				<a href="https://6guts.wordpress.com/" title="6guts" rel="home">
					6guts				</a>
							</div><!-- #site-info -->

			<div id="site-generator">
								<a href="https://wordpress.com/?ref=footer_website" rel="nofollow">Create a free website or blog at WordPress.com.</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->

<!--  -->
<script src='//0.gravatar.com/js/gprofiles.js?ver=202106y' id='grofiles-cards-js'></script>
<script id='wpgroho-js-extra'>
var WPGroHo = {"my_hash":""};
</script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1610363240h'></script>

	<script>
		// Initialize and attach hovercards to all gravatars
		( function() {
			function init() {
				if ( typeof Gravatar === 'undefined' ) {
					return;
				}

				if ( typeof Gravatar.init !== 'function' ) {
					return;
				}

				Gravatar.profile_cb = function ( hash, id ) {
					WPGroHo.syncProfileData( hash, id );
				};

				Gravatar.my_hash = WPGroHo.my_hash;
				Gravatar.init( 'body', '#wp-admin-bar-my-account' );
			}

			if ( document.readyState !== 'loading' ) {
				init();
			} else {
				document.addEventListener( 'DOMContentLoaded', init );
			}
		} )();
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-83ece50530e2901f15da5d0e755deb46">
	</div>
	<div class="grofile-hash-map-5999d5d26089eb4019867dc7705c41a9">
	</div>
	<div class="grofile-hash-map-5147bc9a113fad891146efe41b79f2d6">
	</div>
	<div class="grofile-hash-map-6428904bea03ecf54d864d2bf574a3a2">
	</div>
	</div>
<script id='highlander-comments-js-extra'>
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/6guts.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/6guts.wordpress.com\/wp-login.php?action=logout&_wpnonce=c0076cd1eb","homeURL":"https:\/\/6guts.wordpress.com\/","postID":"466","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"","text_direction":"ltr"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1573483029j'></script>
		<!-- CCPA [start] -->
		<script type="text/javascript">
			( function () {

				var setupPrivacy = function() {

					document.addEventListener( 'DOMContentLoaded', function() {

						// Minimal Mozilla Cookie library
						// https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie/Simple_document.cookie_framework
						var cookieLib = window.cookieLib = {getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,o,n,t,r,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var c="";if(n)switch(n.constructor){case Number:c=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:c="; expires="+n;break;case Date:c="; expires="+n.toUTCString()}return"rootDomain"!==r&&".rootDomain"!==r||(r=(".rootDomain"===r?".":"")+document.location.hostname.split(".").slice(-2).join(".")),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(o)+c+(r?"; domain="+r:"")+(t?"; path="+t:"")+(i?"; secure":""),!0}};

						var setDefaultOptInCookie = function() {
							var value = '1YNN';
							var domain = '.wordpress.com' === location.hostname.slice( -14 ) ? '.rootDomain' : location.hostname;
							cookieLib.setItem( 'usprivacy', value, 365 * 24 * 60 * 60, '/', domain );
						};

						var setCcpaAppliesCookie = function( value ) {
							var domain = '.wordpress.com' === location.hostname.slice( -14 ) ? '.rootDomain' : location.hostname;
							cookieLib.setItem( 'ccpa_applies', value, 24 * 60 * 60, '/', domain );
						}

						var maybeCallDoNotSellCallback = function() {
							if ( 'function' === typeof window.doNotSellCallback ) {
								return window.doNotSellCallback();
							}

							return false;
						}

						var usprivacyCookie = cookieLib.getItem( 'usprivacy' );

						if ( null !== usprivacyCookie ) {
							maybeCallDoNotSellCallback();
							return;
						}

						var ccpaCookie = cookieLib.getItem( 'ccpa_applies' );

						if ( null === ccpaCookie ) {

							var request = new XMLHttpRequest();
							request.open( 'GET', 'https://public-api.wordpress.com/geo/', true );

							request.onreadystatechange = function () {
								if ( 4 === this.readyState ) {
									if ( 200 === this.status ) {

										var data = JSON.parse( this.response );
										var ccpa_applies = data['region'] && data['region'].toLowerCase() === 'california';

										setCcpaAppliesCookie( ccpa_applies );

										if ( ccpa_applies ) {
											if ( maybeCallDoNotSellCallback() ) {
												setDefaultOptInCookie();
											}
										}
									} else {
										setCcpaAppliesCookie( true );
										if ( maybeCallDoNotSellCallback() ) {
											setDefaultOptInCookie();
										}
									}
								}
							};

							request.send();
						} else {
							if ( ccpaCookie === 'true' ) {
								if ( maybeCallDoNotSellCallback() ) {
									setDefaultOptInCookie();
								}
							}
						}
					} );
				};

				if ( window.defQueue && defQueue.isLOHP && defQueue.isLOHP === 2020 ) {
					defQueue.items.push( setupPrivacy );
				} else {
					setupPrivacy();
				}

			} )();
		</script>

		<!-- CCPA [end] -->
					<script type="text/javascript">
			( function( $ ) {
				$( document.body ).on( 'post-load', function () {
					if ( typeof __ATA.insertInlineAds === 'function' ) {
						__ATA.insertInlineAds();
					}
				} );
			} )( jQuery );
			</script>
<script>
window.addEventListener( "load", function( event ) {
	var link = document.createElement( "link" );
	link.href = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.css?v=20201002";
	link.type = "text/css";
	link.rel = "stylesheet";
	document.head.appendChild( link );

	var script = document.createElement( "script" );
	script.src = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.js?v=20201002";
	script.defer = true;
	document.body.appendChild( script );
} );
</script>

	
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/6guts.wordpress.com\/2016\/12\/09\/complex-cocktail-causes-cunning-crash\/":466};
	</script>
				<div class="widget widget_eu_cookie_law_widget">
<div
	class="hide-on-button ads-active"
	data-hide-timeout="30"
	data-consent-expiration="180"
	id="eu-cookie-law"
>
	<form method="post">
		<input type="submit" value="Close and accept" class="accept" />

		Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br />
To find out more, including how to control cookies, see here:
				<a href="https://automattic.com/cookies" rel="nofollow">
			Cookie Policy		</a>
 </form>
</div>
</div><script id='sharing-js-js-extra'>
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFkN1OwzAMhV+I1BQQgwvEoyCTeJ3TJM1iZ2U8PUZiF/yoXNnyOeezbFir80tRKgpRINCJPdW3IcoVfJfqIppJBCf6Q43HTu38VQYuJ6b1X1skrehn10j4/Rc1d1dTn7gIJJ5JwEKdDlhConYxc/GpBxMN7pecLWi4ms5D5rJBXDlMpALUTV1mJpdwBaVcEyr9mG9wMNge94oNMopSs85ps6NkKzSzZFJ3O1zDi10A+6XlDf/n690+ITeQAzYu06Va6Dk/jffjzfi4e7jbxQ8TLqzD'></script>
<script type='text/javascript'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20200826#ver=20200826' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="//stats.wp.com/w.js?61" defer></script> <script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'14597269','blog_tz':'1','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'14597269','v':'wpcom','tz':'1','user_id':'0','post':'466','subd':'6guts'}]);
_stq.push(['extra', {'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRY2gzcWhIRkllQ2l2Q3ZyRGZSdDFEZVhvNj1rNTdSdGl1aEhCQ3pnWlEmMnVtTXlIUlJbRStpdFg3SzUwS19ncCU9d216SVR6NVgrM10uQzJyXWd3RyZYbXg3U21DMFpyUExFTWc2TWVVdXdzVngmLW9kLmZVRDVob1tST3d4cEtHZkxQNDRFMjZtVl93fDBtekVJM0VkUlRZMXpLXVgybj91OC9NeXlJaHQlUGxJYlhDWXNbajA3a1pmMzM4SEsra0I3JWJJNWRNJjRuaV8xMzlrQXRtRTNoTlpERk1PVS9xZl10TkQ4S1dpUHJaLCtzNg=='}]);
_stq.push([ 'clickTrackerInit', '14597269', '466' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px;" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
