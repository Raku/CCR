https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>
Heap heap hooray! | 6guts</title>
<link rel="profile" href="https://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="https://s0.wp.com/wp-content/themes/pub/twentyten/style.css?ver=20190507" />
<link rel="pingback" href="https://6guts.wordpress.com/xmlrpc.php">
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s.pubmine.com' />
<link rel='dns-prefetch' href='//x.bidswitch.net' />
<link rel='dns-prefetch' href='//static.criteo.net' />
<link rel='dns-prefetch' href='//ib.adnxs.com' />
<link rel='dns-prefetch' href='//aax.amazon-adsystem.com' />
<link rel='dns-prefetch' href='//bidder.criteo.com' />
<link rel='dns-prefetch' href='//cas.criteo.com' />
<link rel='dns-prefetch' href='//gum.criteo.com' />
<link rel='dns-prefetch' href='//ads.pubmatic.com' />
<link rel='dns-prefetch' href='//gads.pubmatic.com' />
<link rel='dns-prefetch' href='//tpc.googlesyndication.com' />
<link rel='dns-prefetch' href='//ad.doubleclick.net' />
<link rel='dns-prefetch' href='//googleads.g.doubleclick.net' />
<link rel='dns-prefetch' href='//www.googletagservices.com' />
<link rel='dns-prefetch' href='//cdn.switchadhub.com' />
<link rel='dns-prefetch' href='//delivery.g.switchadhub.com' />
<link rel='dns-prefetch' href='//delivery.swid.switchadhub.com' />
<link rel='dns-prefetch' href='//a.teads.tv' />
<link rel='dns-prefetch' href='//prebid.media.net' />
<link rel='dns-prefetch' href='//adserver-us.adtech.advertising.com' />
<link rel='dns-prefetch' href='//fastlane.rubiconproject.com' />
<link rel='dns-prefetch' href='//prebid-server.rubiconproject.com' />
<link rel='dns-prefetch' href='//hb-api.omnitagjs.com' />
<link rel='dns-prefetch' href='//mtrx.go.sonobi.com' />
<link rel='dns-prefetch' href='//apex.go.sonobi.com' />
<link rel='dns-prefetch' href='//u.openx.net' />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Feed" href="https://6guts.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Comments Feed" href="https://6guts.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="6guts &raquo; Heap heap hooray! Comments Feed" href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s0.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1612197847h&ver=5.6.1"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s0.wp.com/_static/??-eJytUstuwyAQ/KFiZKuplEPVbwGzpcS8BEss/30WorZurLo+9II87Mx6dlg+RzYGj+CRSxs0i7Zo4zOfQ1JCZa5tkMJ2Y85P/C8uzlRaqM6uw0bhyhc/gRUIisWQ8QHtyayZIPMLYBTjxBra0D+5uhCUkDRVEvDruTt3A5fFWFW9N71MIi0842LhH/rgB7gjfZpqNYZYQkGmk1GHrTy0SAKN1/kX+SrAOgLduyiwMhwoI8CSbY97sjmShkkZE+TM6HSmONbm3T7A/ZrHIr/X4Z7UQW6bgrV/7poySgNtDxSqhskAJTlzBBfrNh0IQ0NgZIuyC/4HYO9WmLS/v3X96VNzYq1gFb251/6lH079+fQ8XG7nkUW+?cssminify=yes' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify {
	text-align:justify;
}
</style>
<style id='jetpack-global-styles-frontend-style-inline-css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??-eJxti8sKgCAQAH8oW6KHdoi+xcTUWF1pjX4/OnSIOg0DM3BmYSgVmwrEQ2Q8XEgMmbiIFXXYgb3eQ3IPa8Ncwf/FZIJGgeToLZ+peBstg+/AIS0a72COU9OPUg69atV2AWWKN+I=?cssminify=yes' type='text/css' media='all' />
<script id='jetpack_related-posts-js-extra'>
var related_posts_js_options = {"post_heading":"h4"};
</script>
<script id='wpcom-actionbar-placeholder-js-extra'>
var actionbardata = {"siteID":"14597269","siteName":"6guts","siteURL":"http:\/\/6guts.wordpress.com","icon":"<img alt='' src='https:\/\/s0.wp.com\/i\/logo\/wpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/twentyten","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F&signup_flow=account","themeURL":"","xhrURL":"https:\/\/6guts.wordpress.com\/wp-admin\/admin-ajax.php","nonce":"73a4d0c81a","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"db0032352c\" \/>","referer":"https:\/\/6guts.wordpress.com\/2016\/04\/15\/heap-heap-hooray\/","canFollow":"1","feedID":"913460","statusMessage":"","customizeLink":"https:\/\/6guts.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F","postID":"434","shortlink":"https:\/\/wp.me\/pZfpP-70","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/6guts.wordpress.com\/434","statsLink":"https:\/\/wordpress.com\/stats\/post\/434\/6guts.wordpress.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Twenty Ten","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/read\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 59 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F&signup_flow=account\">Log in now.<\/a>","stats":"Stats"}};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFzdEKwjAMBdAfMiurMPFB/Ja5xZLSpLVpEP9+HSiILz6FezmXuGeBJUtDaS6q43yjhGCKdQ69A5J7HqIeXHckS7IVdYfxYVhf7zMwyV8ETKHODb/x5zMblGSBRF3F1NEKJWv7SX115cs4jf548ufJxw1oVkW8'></script>
<link rel='stylesheet' id='all-css-0-2' href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1530132353h&cssminify=yes' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://6guts.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s0.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/" />
<link rel='shortlink' href='https://wp.me/pZfpP-70' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Heap heap hooray!" />
<meta property="og:url" content="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/" />
<meta property="og:description" content="Last week, I finally hunted down and fixed the EVAL memory leak, with the help of the heap snapshot analyzer I wrote about recently. I also hunted down a hang in parallel runs of the Perl 6 specifi…" />
<meta property="article:published_time" content="2016-04-15T11:55:19+00:00" />
<meta property="article:modified_time" content="2016-04-15T11:55:19+00:00" />
<meta property="og:site_name" content="6guts" />
<meta property="og:image" content="https://6guts.files.wordpress.com/2016/04/profile-screenie.png" />
<meta property="og:image:width" content="961" />
<meta property="og:image:height" content="504" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Heap heap hooray!" />
<meta name="twitter:image" content="https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://6guts.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://6guts.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://6guts.wordpress.com/osd.xml" title="6guts" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<meta name="application-name" content="6guts" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Tales of Perl 6 guts hacking" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://6guts.wordpress.com/feed/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="description" content="Last week, I finally hunted down and fixed the EVAL memory leak, with the help of the heap snapshot analyzer I wrote about recently. I also hunted down a hang in parallel runs of the Perl 6 specification test suite that showed up recently - but only on Windows - and fixed that too. Before&hellip;" />
		<script type="text/javascript">

			window.doNotSellCallback = function() {

				var linkElements = [
					'a[href="https://wordpress.com/?ref=footer_blog"]',
					'a[href="https://wordpress.com/?ref=footer_website"]',
					'a[href="https://wordpress.com/?ref=vertical_footer"]',
					'a[href^="https://wordpress.com/?ref=footer_segment_"]',
				].join(',');

				var dnsLink = document.createElement( 'a' );
				dnsLink.href = 'https://wordpress.com/advertising-program-optout';
				dnsLink.classList.add( 'do-not-sell-link' );
				dnsLink.rel = 'nofollow';
				dnsLink.style.marginLeft = '0.5em';
				dnsLink.textContent = 'Do Not Sell My Personal Information';

				var creditLinks = document.querySelectorAll( linkElements );

				if ( 0 === creditLinks.length ) {
					return false;
				}

				Array.prototype.forEach.call( creditLinks, function( el ) {
					el.insertAdjacentElement( 'afterend', dnsLink );
				});

				return true;
			};

		</script>
				<script type="text/javascript">
		function __ATA_CC() {var v = document.cookie.match('(^|;) ?personalized-ads-consent=([^;]*)(;|$)');return v ? 1 : 0;}
		var __ATA_PP = { pt: 1, ht: 0, tn: 'twentyten', amp: false, siteid: 8982, blogid: 14597269, consent: __ATA_CC()   };
		var __ATA = __ATA || {};
		__ATA.cmd = __ATA.cmd || [];
		__ATA.criteo = __ATA.criteo || {};
		__ATA.criteo.cmd = __ATA.criteo.cmd || [];
		
		</script>
		<script type="text/javascript">
		(function(){var g=Date.now||function(){return+new Date};function h(a,b){a:{for(var c=a.length,d="string"==typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]};function k(a,b,c){c=null!=c?"="+encodeURIComponent(String(c)):"";if(b+=c){c=a.indexOf("#");0>c&&(c=a.length);var d=a.indexOf("?");if(0>d||d>c){d=c;var e=""}else e=a.substring(d+1,c);a=[a.substr(0,d),e,a.substr(c)];c=a[1];a[1]=b?c?c+"&"+b:b:c;a=a[0]+(a[1]?"?"+a[1]:"")+a[2]}return a};var l=0;function m(a,b){var c=document.createElement("script");c.src=a;c.onload=function(){b&&b(void 0)};c.onerror=function(){b&&b("error")};a=document.getElementsByTagName("head");var d;a&&0!==a.length?d=a[0]:d=document.documentElement;d.appendChild(c)}function n(a){var b=void 0===b?document.cookie:b;return(b=h(b.split("; "),function(c){return-1!=c.indexOf(a+"=")}))?b.split("=")[1]:""}function p(a){return"string"==typeof a&&0<a.length}
		function r(a,b,c){b=void 0===b?"":b;c=void 0===c?".":c;var d=[];Object.keys(a).forEach(function(e){var f=a[e],q=typeof f;"object"==q&&null!=f||"function"==q?d.push(r(f,b+e+c)):null!==f&&void 0!==f&&(e=encodeURIComponent(b+e),d.push(e+"="+encodeURIComponent(f)))});return d.filter(p).join("&")}function t(a,b){a||((window.__ATA||{}).config=b.c,m(b.url))}var u=Math.floor(1E13*Math.random()),v=window.__ATA||{};window.__ATA=v;window.__ATA.cmd=v.cmd||[];v.rid=u;v.createdAt=g();var w=window.__ATA||{},x="s.pubmine.com";
		w&&w.serverDomain&&(x=w.serverDomain);var y="//"+x+"/conf",z=window.top===window,A=window.__ATA_PP&&window.__ATA_PP.gdpr_applies,B="boolean"===typeof A?Number(A):null,C=window.__ATA_PP||null,D=z?document.referrer?document.referrer:null:null,E=z?window.location.href:document.referrer?document.referrer:null,F,G=n("__ATA_tuuid");F=G?G:null;var H=window.innerWidth+"x"+window.innerHeight,I=n("usprivacy"),J=r({gdpr:B,pp:C,rid:u,src:D,ref:E,tuuid:F,vp:H,us_privacy:I?I:null},"",".");
		(function(a){var b=void 0===b?"cb":b;l++;var c="callback__"+g().toString(36)+"_"+l.toString(36);a=k(a,b,c);window[c]=function(d){t(void 0,d)};m(a,function(d){d&&t(d)})})(y+"?"+J);}).call(this);
		</script><link rel="amphtml" href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/amp/"><script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_gat._anonymizeIp']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script>
</head>

<body class="post-template-default single single-post postid-434 single-format-standard customizer-styles-applied single-author highlander-enabled highlander-light">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div id="branding" role="banner">
								<div id="site-title">
					<span>
						<a href="https://6guts.wordpress.com/" title="6guts" rel="home">6guts</a>
					</span>
				</div>
				<div id="site-description">Tales of Perl 6 guts hacking</div>

									<a class="home-link" href="https://6guts.wordpress.com/" title="6guts" rel="home">
						<img src="https://6guts.files.wordpress.com/2010/07/cropped-30141.jpg" width="940" height="198" alt="" />
					</a>
								</div><!-- #branding -->

			<div id="access" role="navigation">
								<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
				<div class="menu"><ul>
<li ><a href="https://6guts.wordpress.com/">Home</a></li><li class="page_item page-item-2"><a href="https://6guts.wordpress.com/about/">About</a></li>
<li class="page_item page-item-24"><a href="https://6guts.wordpress.com/interesting-papers/">Interesting Papers</a></li>
</ul></div>
			</div><!-- #access -->
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="https://6guts.wordpress.com/2016/04/05/small-but-welcome-fixes/" rel="prev"><span class="meta-nav">&larr;</span> Small, but welcome,&nbsp;fixes</a></div>
					<div class="nav-next"><a href="https://6guts.wordpress.com/2016/04/21/framing-the-problem/" rel="next">Framing the problem <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-434" class="post-434 post type-post status-publish format-standard hentry category-uncategorized">
											<h2 class="entry-title"><a href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/" rel="bookmark">Heap heap hooray!</a></h2>					
					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted on</span> <a href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/" title="12:55 PM" rel="bookmark"><span class="entry-date">April 15, 2016</span></a> <span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="https://6guts.wordpress.com/author/jnthnwrthngtn/" title="View all posts by jnthnwrthngtn">jnthnwrthngtn</a></span>					</div><!-- .entry-meta -->

					<div class="entry-content">
						<p>Last week, I finally hunted down and fixed the <code>EVAL</code> memory leak, with the help of the heap snapshot analyzer I <a href="https://6guts.wordpress.com/2016/03/27/happy-heapster/">wrote about recently</a>. I also hunted down a hang in parallel runs of the Perl 6 specification test suite that showed up recently &#8211; but only on Windows &#8211; and fixed that too.</p>
<h3><a id="user-content-before-we-begin-a-generational-gc-primer" class="anchor" href="https://gist.github.com/jnthn/b2c6a271d96cd9a95744d7a3b9daa270#before-we-begin-a-generational-gc-primer"></a>Before we begin: a generational GC primer</h3>
<p>A <a href="https://6guts.wordpress.com/2016/03/21/a-whole-heap-of-work/">few posts ago</a> I talked a bit about how MoarVM&#8217;s garbage collector works &#8211; and hand-waved on just about all of the interesting details. Some folks on IRC expressed a bit of curiosity about those details, so I figured I&#8217;d explain some of them as they come up in my performance/reliability work. In this post I&#8217;ll talk about generational collection, because it plays a part in the <code>EVAL</code> leak story.</p>
<p>Recall that the essence of a tracing garbage collector is that we start with a set of roots: global symbols, the current call frame that each thread is executing, thread-local symbols, and so forth. We &#8220;mark&#8221; each object we find in these roots as &#8220;alive&#8221;, and stick them onto a todo list. We work our way through this todo list, asking each object what it references and putting those onto the todo list also. With a little care to never revisit objects we already considered, we terminate having marked all reachable objects alive. The memory associated with unmarked objects can then be freed.</p>
<p>You might worry that if we have millions of objects in memory, this could be a rather time-consuming process to do again and again. You&#8217;d be right. Worse, memory access performance depends heavily on the CPU caches getting high hit rates. When we need to walk huge numbers of objects, we end up getting loads of CPU cache misses, and have to spend time fetching objects from main memory. (To give you an idea of the numbers: a level 1 cache hit means memory access in several CPU cycles, while having to go to main memory can easily cost a couple of hundred cycles or worse).</p>
<p>So, how might we do better? The key insight behind generational GC, often known as the generational hypothesis, is that in most programs objects are either very short-lived (surviving zero or one garbage collections) or long-lived (perhaps staying around for the lifetime of the entire program). Therefore, it&#8217;s reasonable to assume that once an object survives a couple of collections, it will stay around for a good few more.</p>
<p>Generational collection works by dividing the heap &#8211; that is, the space where objects are allocated &#8211; into generations (typically two or three). In MoarVM we have two generations, which we tend to refer to in the code as &#8220;nursery&#8221; and &#8220;gen2&#8221;. The nursery, as the name suggests, is where objects begin their life. We allocate them cheaply there using a &#8220;bump-the-pointer&#8221; scheme. The nursery in MoarVM is a fixed-size chunk of memory, and after a while we fill it up. This is what triggers garbage collection.</p>
<p>In a 2-generation collector, there are two types of collection, which we know as nursery collection and full collection. In a full collection, we do exactly what I described earlier: visit all objects, marking them alive, and freeing up those that aren&#8217;t. A nursery collection is similar, except as soon as we see an object is not in the nursery, we don&#8217;t put it on the todo list. Instead, we simply ignore it. This greatly cuts down on the number of objects we need to consider, making nursery collections hugely cheaper.</p>
<p>There are two things we must do to make this really work. The first is ensure that we only free memory associated with objects living in the nursery, not the old generation, since we didn&#8217;t do the analysis needed to free anything there. That&#8217;s fine; most objects &#8220;die young&#8221; anyway. The second is more subtle. There may be objects in the nursery that are only alive because something in the old generation references them. However, since we&#8217;re not considering any old generation objects, we won&#8217;t discover this liveness and so wrongly free things. This is resolved by maintaining a set of objects that are in the old generation but pointing to objects in the nursery. Whenever we assign a reference from one object to another, we check if this would establish an old generation to nursery reference, and stick the old generation object into the set, ensuring we will visit it and mark the nursery object. This check is known as a &#8220;write barrier&#8221;.</p>
<p>So, back to the <code>EVAL</code> story&#8230;</p>
<h3><a id="user-content-the-eval-leak" class="anchor" href="https://gist.github.com/jnthn/b2c6a271d96cd9a95744d7a3b9daa270#the-eval-leak"></a>The EVAL leak</h3>
<p>I reviewed, fixed up, and merged various patches from Timo to improve the heap snapshot data dumps by annotating them with more data. Then, I looked at a few paths to leaked objects (recall that I was using <code>EVAL 'my class ABC { }'</code> to demonstrate the leak). The paths looked something like this:</p>
<pre><code>&gt; path 38199
Root
    --[ Thread Roots ]--&gt;
Thread Roots
    --[ Lexotic cache entry ]--&gt;
Lexotic (Object)
    --[ Unknown ]--&gt;
BOOTStaticFrame (Object)
    --[ Unknown ]--&gt;
BOOTCompUnit (Object)
    --[ Index 81 ]--&gt;
BOOTCode (Object)
    --[ Unknown ]--&gt;
BOOTStaticFrame (Object)
    --[ Unknown ]--&gt;
ABC (STable)
</code></pre>
<p>This shows the objects along the path, but those &#8220;unknowns&#8221; were hiding what I really wanted to know. So, I did some further patches, and got out a rather more useful result:</p>
<pre><code>&gt; path 6466
Root
    --[ Thread Roots ]--&gt;
Thread Roots
    --[ Lexotic cache entry ]--&gt;
Lexotic (Object)
    --[ Static Frame ]--&gt;
BOOTStaticFrame (Object)
    --[ Compilation Unit ]--&gt;
BOOTCompUnit (Object)
    --[ Code refs array entry ]--&gt;
BOOTCode (Object)
    --[ Unknown ]--&gt;
BOOTStaticFrame (Object)
    --[ Spesh guard match ]--&gt;
ABC (STable)
</code></pre>
<p>So, here we see that it&#8217;s a type specializer guard that is keeping the object alive. &#8220;Wait&#8230;a what?!&#8221; MoarVM does a bunch of dynamic optimization, watching out for types that occur at runtime and generating specialized versions of the code by type. And, sometimes, we have an unfortunate situation where code is discovered &#8220;hot&#8221;, but the type it was invoked with is fairly transient. In this case, the specialization matching table will end up referring to that type, keeping it alive.</p>
<p>However, since for any given bit of code we only generate a handful of these specializations, eventually we&#8217;d saturate them and stop leaking memory. I looked at another path:</p>
<pre><code>&gt; path 10594
Root
    --[ Thread Roots ]--&gt;
Thread Roots
    --[ Lexotic cache entry ]--&gt;
Lexotic (Object)
    --[ Static Frame ]--&gt;
BOOTStaticFrame (Object)
    --[ Compilation Unit ]--&gt;
BOOTCompUnit (Object)
    --[ Code refs array entry ]--&gt;
BOOTCode (Object)
    --[ Unknown ]--&gt;
BOOTStaticFrame (Object)
    --[ Spesh log slots ]--&gt;
QAST::CompUnit (Object)
    --[ Unknown ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)
</code></pre>
<p>This is a case where the optimizer is tracing what objects show up. In fact, most of the paths looked this way. However, that should saturate at some point, yet I know that it goes on leaking. Finally, I found another path to a leak:</p>
<pre><code>&gt; path 59877
Root
    --[ Permanent Roots ]--&gt;
Permanent roots
    --[ Boxed integer cache entry ]--&gt;
Int (Object)
    --[ &lt;SC&gt; ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)
</code></pre>
<p>However, 9 out of the 10 leaked objects were leaked because of the dynamic optimizer keeping things alive that it had seen while tracing. But that, while awkward, should eventually saturate &#8211; as should the integer cache issue. But the memory use grew forever, suggesting that things go on and on leaking. So, I tried a snapshot after disabling dynamic optimization. And:</p>
<pre><code>&gt; find stables type="ABC"
Object Id  Description
=========  ===========
368871     ABC
</code></pre>
<p>Just the one! 9 out of 10 objects were not on the heap. And yes, it was the integer box cache problem that kept the 1 alive:</p>
<pre><code>&gt; path 368871
Root
    --[ Permanent Roots ]--&gt;
Permanent roots
    --[ Boxed integer cache entry ]--&gt;
Int (Object)
    --[ &lt;SC&gt; ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)
</code></pre>
<p>So in theory, with dynamic optimization disabled, this suggested that we did not leak any more, and all the blame was on the optimizer. To check that out, I tried a long-running <code>EVAL</code> loop and&#8230;it still leaked heavily. My theory that dynamic optimization couldn&#8217;t account for all of the leaking, just the first bit of it, seemed to hold up.</p>
<p>To investigate it further, I did a loop of 100 <code>EVAL</code>s, as opposed to the 10 I had used so far. This took a snapshot every GC run, plus one more that I forced at the end. So, how did the final snapshot look?</p>
<pre><code>This file contains 9 heap snapshots. To select one to look
at, type something like `snapshot 1`.
Type `help` for available commands, or `exit` to exit.

&gt; snapshot 8
Loading that snapshot. Carry on...
&gt; summary
Wait a moment, while I finish loading the snapshot...

    Total heap size:              33,417,225 bytes

    Total objects:                369,541
    Total type objects:           1,960
    Total STables (type tables):  1,961
    Total frames:                 2,077
    Total references:             1,302,511

&gt; find stables type="ABC"
Object Id  Description
=========  ===========
368872     ABC
</code></pre>
<p>Only the one. So, according to this, we&#8217;re not leaking. But that&#8217;s when the loop is over. What about a mid-loop GC? I switched to a snapshot in the middle, and:</p>
<pre><code>&gt; find stables type="ABC"
Object Id  Description
=========  ===========
130353     ABC
376552     ABC

&gt; path 130353
Root
    --[ Permanent Roots ]--&gt;
Permanent roots
    --[ Boxed integer cache entry ]--&gt;
Int (Object)
    --[ &lt;SC&gt; ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)

&gt; path 376552
Root
    --[ Thread Roots ]--&gt;
Thread Roots
    --[ Lexotic cache entry ]--&gt;
Lexotic (Object)
    --[ Result ]--&gt;
NQPMatch (Object)
    --[ Unknown ]--&gt;
QAST::CompUnit (Object)
    --[ Unknown ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)
</code></pre>
<p>OK, that&#8217;s reasonable too: it&#8217;s alive because it&#8217;s referred to by the compiler, which is run as part of <code>EVAL</code>ing the code. So what are we leaking? I tried this:</p>
<pre><code>&gt; top objects by size
Name                                   Total Bytes
=====================================  ===============
NQPArray                               7,114,800 bytes
BOOTStaticFrame                        4,806,668 bytes
BOOTInt                                4,642,720 bytes
VMString                               2,859,188 bytes
BOOTHash                               2,253,016 bytes
SCRef                                  1,891,768 bytes
NFAType                                1,886,272 bytes
BOOTCode                               1,448,208 bytes
BOOTNum                                832,096 bytes
Parameter                              783,360 bytes
BOOTStr                                567,936 bytes
BOOTCompUnit                           513,149 bytes
Perl6::Metamodel::ContainerDescriptor  341,496 bytes
QAST::Op                               266,400 bytes
Signature                              208,440 bytes
</code></pre>
<p>Then compared with an earlier snapshot</p>
<pre><code>&gt; snapshot 2
Loading that snapshot. Carry on...
&gt; top objects by size
Name                                   Total Bytes
=====================================  ===============
NQPArray                               7,110,920 bytes
BOOTStaticFrame                        4,806,152 bytes
BOOTInt                                4,642,624 bytes
VMString                               2,858,472 bytes
BOOTHash                               2,241,320 bytes
SCRef                                  1,891,696 bytes
NFAType                                1,886,272 bytes
BOOTCode                               1,447,776 bytes
BOOTNum                                832,096 bytes
Parameter                              783,360 bytes
BOOTStr                                567,136 bytes
BOOTCompUnit                           513,149 bytes
Perl6::Metamodel::ContainerDescriptor  341,496 bytes
QAST::Op                               266,112 bytes
Signature                              208,296 bytes
</code></pre>
<p>Again, nothing very interesting to note. This highly suggested that either there was some missing information in the heap snapshot, or something else in the VM state &#8211; but that got cleaned up at exit &#8211; that was also getting leaked.</p>
<p>So I pondered a bit, and compared the GC marking code with the heap snapshot code. And&#8230;had an &#8220;aha!&#8221; moment. Remember I talked about the inter-generational root set that we keep thanks to generational collection? This was not being accounted for in heap snapshots. I <a href="https://github.com/MoarVM/MoarVM/commit/e016fefde4dfd3a9f73fdc5c109234d124b56c59">fixed it</a>, and the size of the resulting heap snapshot files was a dead giveaway that it made a huge difference:</p>
<pre><code>04/06/2016  14:46       184,272,062 rak-heap-6
04/06/2016  15:21       262,846,653 rak-heap-7
</code></pre>
<p>And, back in the analyzer:</p>
<pre><code>&gt; snapshot 2
Loading that snapshot. Carry on...
&gt; find stables type="ABC"
Wait a moment, while I finish loading the snapshot...

Object Id  Description
=========  ===========
21266      ABC
21312      ABC
22359      ABC
23317      ABC
24275      ABC
25233      ABC
26191      ABC
27149      ABC
28107      ABC
29065      ABC
30023      ABC
30981      ABC
361108     ABC
363007     ABC
364903     ABC
</code></pre>
<p>So, the objects were there, after all. I took a look at some of them:</p>
<pre><code>&gt; path 24275
Root
    --[ Inter-generational Roots ]--&gt;
Inter-generational Roots
    --[ Index 24269 ]--&gt;
ABC (STable)

&gt; path 30981
Root
    --[ Inter-generational Roots ]--&gt;
Inter-generational Roots
    --[ Index 30975 ]--&gt;
ABC (STable)

&gt; path 363007
Root
    --[ Inter-generational Roots ]--&gt;
Inter-generational Roots
    --[ Index 21244 ]--&gt;
BOOTCompUnit (Object)
    --[ Serialization context dependency ]--&gt;
SCRef (Object)
    --[ STable root set ]--&gt;
ABC (STable)
</code></pre>
<p>This would explain a prolonged lifetime, but not an unending leak. I found myself missing a count command so I could easily see how things varied between the snapshots. I <a href="https://github.com/jnthn/p6-app-moarvm-heapanalyzer/commit/9a1806ba6434380893de1006711151e7e424547c">implemented it</a>, then observed this:</p>
<pre><code>&gt; snapshot 2
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
34
&gt; snapshot 5
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
72
&gt; snapshot 7
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
97
&gt; snapshot 8
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
100
</code></pre>
<p>The number of objects in the inter-generational set just kept on growing! So, either this workload was just not triggering a gen-2 collection, or there was a bug. How to find out? By doing a normal <code>--profile</code> on the same code, and looking at the output. The summary page stated:</p>
<blockquote><p>The profiled code did 9 garbage collections. There were 0 full collections involving the entire heap.</p></blockquote>
<p>OK, so we really never did a full collection. That explains this particular snapshot, but not the leak over time, which surely would end up triggering a full collection at some point. To test that theory, I tweaked a MoarVM header to make full collections happen more often, to see it helped:</p>
<pre><code>diff --git a/src/gc/collect.h b/src/gc/collect.h
index b31a112..af6c456 100644
--- a/src/gc/collect.h
+++ b/src/gc/collect.h
@@ -6,7 +6,7 @@
 /* How many bytes should have been promoted into gen2 before we decide to
  * do a full GC run? The numbers below are used as a base amount plus an
  * extra amount per extra thread we have running. */
-#define MVM_GC_GEN2_THRESHOLD_BASE      (30 * 1024 * 1024)
+#define MVM_GC_GEN2_THRESHOLD_BASE      (1 * 1024 * 1024)
 #define MVM_GC_GEN2_THRESHOLD_THREAD    (2 * 1024 * 1024)
</code></pre>
<p>This change made it do a full collection for every 1MB promoted, not every 30MB. Hopefully that would be enough to trigger an some runs. And it did:</p>
<blockquote><p>The profiled code did 9 garbage collections. There were 4 full collections involving the entire heap.</p></blockquote>
<p>Much better. So, over in the heap profiler:</p>
<pre><code>Considering the snapshot...looks reasonable!

This file contains 9 heap snapshots. To select one to look
at, type something like `snapshot 5`.
Type `help` for available commands, or `exit` to exit.

&gt; snapshot 2
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
34
&gt; snapshot 5
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
72
&gt; snapshot 7
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
97
&gt; snapshot 8
Loading that snapshot. Carry on...
&gt; count stables type="ABC"
100
</code></pre>
<p>Well, ouch. That implies that the inter-generational root set keeps on growing and growing, for some reason. The profiler, which reports this number, agrees with this assessment (note the numbers of gen2 roots on the right):</p>
<p><a href="https://6guts.files.wordpress.com/2016/04/profile-screenie.png" rel="attachment wp-att-436"><img loading="lazy" data-attachment-id="436" data-permalink="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/profile-screenie/" data-orig-file="https://6guts.files.wordpress.com/2016/04/profile-screenie.png" data-orig-size="961,504" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="profile-screenie" data-image-description="" data-medium-file="https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=300" data-large-file="https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=640" class="aligncenter size-large wp-image-436" src="https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=640&#038;h=336" alt="profile-screenie" width="640" height="336" srcset="https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=640&amp;h=336 640w, https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=150&amp;h=79 150w, https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=300&amp;h=157 300w, https://6guts.files.wordpress.com/2016/04/profile-screenie.png?w=768&amp;h=403 768w, https://6guts.files.wordpress.com/2016/04/profile-screenie.png 961w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>So, how could this possibly be happening?</p>
<p>I like to rule out the really silly things first. Like, if the thing that cleans up the inter-generational roots list after a full collection is being called. How? With a <code>printf</code>, of course! :P</p>
<pre><code>diff --git a/src/gc/roots.c b/src/gc/roots.c
index b771106..361b472 100644
--- a/src/gc/roots.c
+++ b/src/gc/roots.c
@@ -301,7 +301,7 @@ void MVM_gc_root_gen2_cleanup(MVMThreadContext *tc) {
     MVMuint32        num_roots    = tc-&gt;num_gen2roots;
     MVMuint32        i = 0;
     MVMuint32        cur_survivor;
-
+printf("cleaning up gen2 roots\n");
     /* Find the first collected object. */
     while (i &lt; num_roots &amp;&amp; gen2roots[i]-&gt;flags &amp; MVM_CF_GEN2_LIVE)
         i++;
</code></pre>
<p>And&#8230;no output. I couldn&#8217;t quite belive it. So, I went to the place that this function is called, and noticed there was some logging I could switch on that describes all the ins and outs of a organizing a GC run. That produced plenty of output, and showed it was indeed not reaching the place where it would call the gen2 roots cleanup either.</p>
<p>After some hunting, I discovered that an addition a while ago that tracked the amount of data promoted to the old generation, and used it to decide whether to do a full collection, had resulted in a nasty accident. It did the calculation to check if a full collection was needed in two different places, and the answer could change between them. This led to us not going through all the steps that a full collection would need.</p>
<p>I <a href="https://github.com/MoarVM/MoarVM/commit/7f2a6fa8416d824c5b66e31e90720c97913decf3">patched it</a> and&#8230;the leak was gone. Even with dynamic optimization re-enabled and full collections back to being run after every promoted 30MB, the ever-increasing memory use of <code>EVAL</code> in a loop was no more. It climbed for a short while, then flattened out.</p>
<p>This fix will likely help numerous longer-running programs that have medium-lifetime objects. It also shaved around 45MB off CORE.setting compilation memory use. Unfortunately, it also caused a 5% slowdown in the Rakudo build-time, presumably because we were now actually doing all the work we should be on full collections!</p>
<h3><a id="user-content-a-bit-of-tuning" class="anchor" href="https://gist.github.com/jnthn/b2c6a271d96cd9a95744d7a3b9daa270#a-bit-of-tuning"></a>A bit of tuning</h3>
<p>With the leak out of the way &#8211; or at least, the big one &#8211; I wanted my 5% back. So I took a look at our logic for how we decide whether or not to do a full collection. The strategy so far had been to expect a fixed amount of memory to have been promoted to the old generation (with some additions per thread). However, this was lacking in a couple of ways.</p>
<p>For one, it only accounted for the direct size of objects, not any extra unmanaged memory they held. So, a compilation unit would not factor in the size of the compiled bytecode it held on to, and a dynamic array would not factor in the size of its storage. This was now an <a href="https://github.com/MoarVM/MoarVM/commit/e95ed884143295277fce3cce3a34cb3fc7048bb1">easy enough fix</a> thanks to additions made while implementing heap snapshots.</p>
<p>For two, a fixed limit doesn&#8217;t behave too well with programs that really do build up a large heap over time. There, we can afford to promote a good bit more beforehand, and percentage wise it won&#8217;t make a lot of difference since they&#8217;re growing anyway. Building Rakudo&#8217;s CORE.setting is like this, as it builds up the program tree. So, I <a href="https://github.com/MoarVM/MoarVM/commit/6112aaa9f997fdc7b8188a27b2dcedf0ea3e14fd">switched to a percentage-based scheme with a minimum threshold</a>, which could afford to be a bit lower than the 30MB from before. These changes not only got Rakudo&#8217;s CORE.setting build time back down again (without having to give up much of the memory savings from before), but also had the <code>EVAL</code> loop example having a lower memory ceiling.</p>
<p>So, not only did I hunt down and fix the memory leak, I ended up tuning things to achieve a lower memory ceiling for applications whose memory footprint is fairly fixed over their life them, and less full GC runs for those growing over time.</p>
<h3><a id="user-content-hunting-down-a-parallel-spectest-hang" class="anchor" href="https://gist.github.com/jnthn/b2c6a271d96cd9a95744d7a3b9daa270#hunting-down-a-parallel-spectest-hang"></a>Hunting down a parallel spectest hang</h3>
<p>On Windows, a parallel spectest of high enough degree could cause hangs. I use <code>TEST_JOBS=12</code>, a number I picked after some measuring in the past. In the last couple of weeks, I started seeing hangs &#8211; and they went away if I cut down <code>TEST_JOBS </code>to just running 2 or 3 in parallel.</p>
<p>Eventually, helped by <code>make localtest</code> (where you can specify a file listing the tests to run), I managed to get it down to just 2 tests that, when run together, would reliably hang. It turned out one of them spawned another Rakudo process as part of the test, so there were 3 processes involved. Attaching the debugger to each in turn, I saw one was hung on getting a file lock, one was hung waiting for process termination (and was waiting on the process that was blocked on a file lock), and the other was blocked trying to write the <code>STDOUT</code>.</p>
<p>I don&#8217;t know <em>for sure</em>, but so far as I can tell, the way the test harness does parallel testing on Windows involves running batches of tests and reading a bit of TAP from them one at a time. The process blocked writing to <code>STDOUT</code> was also the one holding the file lock, but the test harness was, I presume, waiting to read output from the process blocked waiting for the process that was in turn waiting for the file lock. So, a nice circular wait involving 4 processes, one of them being the test harness! Typical darn Friday bug hunting&#8230; :-)</p>
<p>This also explained nicely why the issue didn&#8217;t crop up away from Windows: parallel spectest works differently (read: better) on other platforms. :-) While we will at some point switch to using a Perl 6 test harness for running the spectests that hopefully behaves consistently everywhre, I figured that Rakudo was probably doing something wrong with regard to the file lock.</p>
<p>File locks are used in only one place in Rakudo: managing pre-compilations. A little instrumentation of the lock/unlock code later, I saw a mis-match. A dump of the stack trace at each place we did a lock/unlock eventually led me to the problem, which I was able <a href="https://github.com/rakudo/rakudo/commit/a93edd9f0196dc79444b6180fe27a598558b105d">to fix</a>. This bug likely didn&#8217;t just affect spectest on Windows; I suspect I could construct various hangs on other platforms too from it. So, a good fix to have in there.</p>
<p>As a side-note, the reason this bug was both likely to happen and hard to identify was because the lock and unlock were not placed on the same code-path. This is a good idea for any kind of locking. Locks are horrible to work with anyway; putting lock/unlock far apart in the code is just asking for problems (and this is far from the first problem I&#8217;ve hunted down in code with such a structure). So, I&#8217;ve asked nine++, as part of his great work to keep improving our installation and precomp handling, to look into addressing this, so we&#8217;re structurally in a better place to not have such bugs.</p>
<p>And, for all of you out there using Rakudo&#8217;s <code>Lock</code> class: first, don&#8217;t, and second, if you must use it, always prefer the <code>$lock.protect({ ... })</code> form over manual <code>lock</code>/<code>unlock</code> method calls.</p>
<h3><a id="user-content-two-icky-problems-less" class="anchor" href="https://gist.github.com/jnthn/b2c6a271d96cd9a95744d7a3b9daa270#two-icky-problems-less"></a>Two icky problems less&#8230;</h3>
<p>So, not a bad last week&#8217;s Perl 6 work &#8211; though it took me all of this week to get around to writing it up. Maybe I&#8217;ll be a little faster writing up this week&#8217;s happenings. :-)</p>
<div id="atatags-370373-6027b8bd4eaac">
        <script type="text/javascript">
            __ATA.cmd.push(function() {
                __ATA.initVideoSlot('atatags-370373-6027b8bd4eaac', {
                    sectionId: '370373',
                    format: 'inread'
                });
            });
        </script>
    </div>			<div id="atatags-26942-6027b8bd4eb0a"></div>
			
			<script>
				__ATA.cmd.push(function() {
					__ATA.initDynamicSlot({
						id: 'atatags-26942-6027b8bd4eb0a',
						location: 120,
						formFactor: '001',
						label: {
							text: 'Advertisements',
						},
						creative: {
							reportAd: {
								text: 'Report this ad',
							},
							privacySettings: {
								text: 'Privacy',
								
							}
						}
					});
				});
			</script><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-434" class="share-twitter sd-button share-icon" href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-434" class="share-facebook sd-button share-icon" href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-14597269-434-6027b8bd4f1a4' data-src='//widgets.wp.com/likes/index.html?ver=20200826#blog_id=14597269&amp;post_id=434&amp;origin=6guts.wordpress.com&amp;obj_id=14597269-434-6027b8bd4f1a4' data-name='like-post-frame-14597269-434-6027b8bd4f1a4'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>											</div><!-- .entry-content -->

		
						<div class="entry-utility">
							This entry was posted in <a href="https://6guts.wordpress.com/category/uncategorized/" rel="category tag">Uncategorized</a>. Bookmark the <a href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/" title="Permalink to Heap heap hooray!" rel="bookmark">permalink</a>.													</div><!-- .entry-utility -->
					</div><!-- #post-434 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="https://6guts.wordpress.com/2016/04/05/small-but-welcome-fixes/" rel="prev"><span class="meta-nav">&larr;</span> Small, but welcome,&nbsp;fixes</a></div>
					<div class="nav-next"><a href="https://6guts.wordpress.com/2016/04/21/framing-the-problem/" rel="next">Framing the problem <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
			<div id="comments">


			<h3 id="comments-title">
			4 Responses to <em>Heap heap hooray!</em>			</h3>


			<ol class="commentlist">
						<li class="post pingback">
		<p>Pingback: <a href='https://p6weekly.wordpress.com/2016/04/18/2016-16-a-quick-one-from-dublin/' rel='external nofollow ugc' class='url'>2016.16 A Quick One From Dublin | Weekly changes in and around Perl 6</a></p>
				</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="li-comment-2440">
		<div id="comment-2440">
			<div class="comment-author vcard">
				<img alt='' src='https://0.gravatar.com/avatar/c6b297bd0b0e9695ace8e3501aeca372?s=40&#038;d=identicon&#038;r=G' class='avatar avatar-40' height='40' width='40' />				<cite class="fn">Alan Rocker</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->

				
				
			<div class="comment-meta commentmetadata"><a href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/#comment-2440">
				April 19, 2016 at 12:24 AM</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>This may be a naive and foolish idea, but until things settle down a bit more, might it be an idea to put numbers like those thresholds into an rc file, loaded at the start of a run? That way, you don&#8217;t have to keep recompiling while tuning them.</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/?replytocom=2440#respond' data-commentid="2440" data-postid="434" data-belowelement="comment-2440" data-respondelement="respond" data-replyto="Reply to Alan Rocker" aria-label='Reply to Alan Rocker'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

				<ul class="children">
		<li class="comment byuser comment-author-jnthnwrthngtn bypostauthor odd alt depth-2 highlander-comment" id="li-comment-2442">
		<div id="comment-2442">
			<div class="comment-author vcard">
				<img alt='' src='https://2.gravatar.com/avatar/5999d5d26089eb4019867dc7705c41a9?s=40&#038;d=identicon&#038;r=G' class='avatar avatar-40' height='40' width='40' />				<cite class="fn"><a href='https://6guts.wordpress.com' rel='external nofollow ugc' class='url'>jnthnwrthngtn</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->

				
				
			<div class="comment-meta commentmetadata"><a href="https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/#comment-2442">
				April 21, 2016 at 6:05 PM</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>It&#8217;s neither naive nor foolish&#8230;though we&#8217;d probably do it as an environment variable to match various other MoarVM options. It could also be worth doing to expose such tuning possibilities to userland &#8211; and I guess that&#8217;s in a way why it&#8217;s not been done yet, because that means committing to supporting such functionality. :-) The real reason it&#8217;s not done yet, though, is that `make -j install` in MoarVM is really quite fast, and you don&#8217;t have to rebuild NQP/Rakudo afterwards &#8211; so it&#8217;s just not that painful to tweak the header and re-compile.</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='https://6guts.wordpress.com/2016/04/15/heap-heap-hooray/?replytocom=2442#respond' data-commentid="2442" data-postid="434" data-belowelement="comment-2442" data-respondelement="respond" data-replyto="Reply to jnthnwrthngtn" aria-label='Reply to jnthnwrthngtn'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

				</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="post pingback">
		<p>Pingback: <a href='https://6guts.wordpress.com/2016/04/21/framing-the-problem/' rel='external nofollow ugc' class='url'>Framing the problem | 6guts</a></p>
				</li><!-- #comment-## -->
			</ol>


	

	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2016/04/15/heap-heap-hooray/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://6guts.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"><input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="d7e6913b3a" /><input type="hidden" name="_wp_http_referer" value="/2016/04/15/heap-heap-hooray/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">
	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" class="nascar-signin-link"
                   title="Login via Guest">
									</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" class="nascar-signin-link"
                   title="Login via WordPress.com">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg>				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2F6guts.wordpress.com&#038;color_scheme=light" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" class="nascar-signin-link"
                   title="Login via Twitter">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg>				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" class="nascar-signin-link"
                   title="Login via Facebook">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg>				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url" value="" /></div>
				</div>
			</div>
			
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
						<p class="comment-form-posting-as pa-wordpress">
			<strong></strong>
			You are commenting using your WordPress.com account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
						<p class="comment-form-posting-as pa-googleplus">
			<strong></strong>
			You are commenting using your Google account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" x="0px" y="0px" viewBox="0 0 60 60" ><path fill="#519bf7" d="M56.3,30c0,-1.6 -0.2,-3.4 -0.6,-5h-3.1H42.2H30v10.6h14.8C44,39.3 42,42 39.1,43.9l8.8,6.8C53,46 56.3,39 56.3,30z" /><path fill="#3db366" d="M30,57.5c6.7,0 13.1,-2.4 17.9,-6.8l-8.8,-6.8c-2.5,1.6 -5.6,2.4 -9.1,2.4c-7.2,0 -13.3,-4.7 -15.4,-11.2l-9.3,7.1C9.8,51.3 19.1,57.5 30,57.5z" /><path fill="#fdc600" d="M5.3,42.2l9.3,-7.1c-0.5,-1.6 -0.8,-3.3 -0.8,-5.1s0.3,-3.5 0.8,-5.1l-9.3,-7.1C3.5,21.5 2.5,25.6 2.5,30S3.5,38.5 5.3,42.2z" /><path fill="#f15b44" d="M40.1,17.4l8,-8C43.3,5.1 37,2.5 30,2.5C19.1,2.5 9.8,8.7 5.3,17.8l9.3,7.1c2.1,-6.5 8.2,-11.1 15.4,-11.1C33.9,13.7 37.4,15.1 40.1,17.4z" /></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
						<p class="comment-form-posting-as pa-twitter">
			<strong></strong>
			You are commenting using your Twitter account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
						<p class="comment-form-posting-as pa-facebook">
			<strong></strong>
			You are commenting using your Facebook account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function () {

	function hide( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.setProperty( 'display', 'none' );
		}
	}

	function show( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.removeProperty( 'display' );
		}
	}

	var input = document.createElement( 'input' );
	var comment = document.querySelector( '#comment' );

	if ( input && comment && 'placeholder' in input ) {
		var label = document.querySelector( '.comment-textarea label' );
		if ( label ) {
			var text = label.textContent;
			label.parentNode.removeChild( label );
			comment.setAttribute( 'placeholder', text );
		}
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	hide( '#comment-form-identity' );
	hide( '#comment-form-subscribe' );
	hide( '#commentform .form-submit' );

	if ( comment ) {
		comment.style.height = '10px';

		var handler = function () {
			comment.style.height = HighlanderComments.initialHeight + 'px';
			show( '#comment-form-identity' );
			show( '#comment-form-subscribe' );
			show( '#commentform .form-submit' );
			HighlanderComments.resizeCallback();

			comment.removeEventListener( 'focus', handler );
		};

		comment.addEventListener( 'focus', handler );
	}
}

if ( document.readyState !== 'loading' ) {
	highlander_expando_javascript();
} else {
	if ( typeof window.jQuery === 'function' ) {
		// Use jQuery's `ready` if available.
		// This solves some scheduling issues between this script and the main highlander script.
		jQuery( document ).ready( highlander_expando_javascript );
	} else {
		// If not available, add a vanilla event listener.
		document.addEventListener( 'DOMContentLoaded', highlander_expando_javascript );
	}
}

</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p><p class="post-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog"  style="display: inline;">Notify me of new posts via email.</label></p></div>




<p class="form-submit"><input name="submit" type="submit" id="comment-submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='434' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="0160857406" /></p>
<input type="hidden" name="genseq" value="1613215933" />
<input type="hidden" id="ak_js" name="ak_js" value="40"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	<div style="clear: both"></div><p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div><!-- #comments -->

	
			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
						<ul class="xoxo">

<li id="search-2" class="widget-container widget_search"><form role="search" method="get" id="searchform" class="searchform" action="https://6guts.wordpress.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></li>
		<li id="recent-posts-2" class="widget-container widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="https://6guts.wordpress.com/2020/10/05/taking-a-break-from-raku-core-development/">Taking a break from Raku core&nbsp;development</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2019/01/02/my-perl-6-wishes-for-2019/">My Perl 6 wishes for&nbsp;2019</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/">Speeding up object&nbsp;creation</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/09/29/eliminating-unrequired-guards/">Eliminating unrequired guards</a>
									</li>
											<li>
					<a href="https://6guts.wordpress.com/2018/09/28/faster-box-unbox-and-int-operations/">Faster box/unbox and Int&nbsp;operations</a>
									</li>
					</ul>

		</li><li id="recent-comments-2" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3>				<table class="recentcommentsavatar" cellspacing="0" cellpadding="0" border="0">
					<tr><td title="2019.01 Wishes for 2019 | Weekly changes in and around Perl 6" class="recentcommentsavatartop" style="height:48px; width:48px;"><a href="https://p6weekly.wordpress.com/2019/01/08/2019-01-wishes-for-2019/" rel="nofollow"></a></td><td class="recentcommentstexttop" style=""><a href="https://p6weekly.wordpress.com/2019/01/08/2019-01-wishes-for-2019/" rel="nofollow">2019.01 Wishes for 2&hellip;</a> on <a href="https://6guts.wordpress.com/2019/01/02/my-perl-6-wishes-for-2019/#comment-6005">My Perl 6 wishes for&nbsp;2019</a></td></tr><tr><td title="hobbified (@hobbified)" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://twitter.com/hobbified" rel="nofollow"><img alt='' src='https://i1.wp.com/pbs.twimg.com/profile_images/67477518/dr_haas_normal.jpg?resize=48%2C48' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="http://twitter.com/hobbified" rel="nofollow">hobbified (@hobbifie&hellip;</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5966">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="Alex" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://gravatar.com/kaokun" rel="nofollow"><img alt='' src='https://0.gravatar.com/avatar/6428904bea03ecf54d864d2bf574a3a2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="http://gravatar.com/kaokun" rel="nofollow">Alex</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5913">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="jnthnwrthngtn" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="https://6guts.wordpress.com" rel="nofollow"><img alt='' src='https://2.gravatar.com/avatar/5999d5d26089eb4019867dc7705c41a9?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></a></td><td class="recentcommentstextend" style=""><a href="https://6guts.wordpress.com" rel="nofollow">jnthnwrthngtn</a> on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5907">Speeding up object&nbsp;creati&hellip;</a></td></tr><tr><td title="Alex" class="recentcommentsavatarend" style="height:48px; width:48px;"><img alt='' src='https://0.gravatar.com/avatar/6428904bea03ecf54d864d2bf574a3a2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstextend" style="">Alex on <a href="https://6guts.wordpress.com/2018/10/06/speeding-up-object-creation/#comment-5896">Speeding up object&nbsp;creati&hellip;</a></td></tr>				</table>
				</li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href='https://6guts.wordpress.com/2020/10/'>October 2020</a></li>
	<li><a href='https://6guts.wordpress.com/2019/01/'>January 2019</a></li>
	<li><a href='https://6guts.wordpress.com/2018/10/'>October 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/09/'>September 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/07/'>July 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/06/'>June 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/03/'>March 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2018/01/'>January 2018</a></li>
	<li><a href='https://6guts.wordpress.com/2017/11/'>November 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/09/'>September 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/08/'>August 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/07/'>July 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/06/'>June 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/05/'>May 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/04/'>April 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2017/03/'>March 2017</a></li>
	<li><a href='https://6guts.wordpress.com/2016/12/'>December 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/11/'>November 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/08/'>August 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/07/'>July 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/06/'>June 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/04/'>April 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/03/'>March 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/02/'>February 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2016/01/'>January 2016</a></li>
	<li><a href='https://6guts.wordpress.com/2015/12/'>December 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/11/'>November 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/10/'>October 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/09/'>September 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/08/'>August 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/07/'>July 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/06/'>June 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/05/'>May 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2015/04/'>April 2015</a></li>
	<li><a href='https://6guts.wordpress.com/2014/06/'>June 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2014/04/'>April 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2014/01/'>January 2014</a></li>
	<li><a href='https://6guts.wordpress.com/2013/12/'>December 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/10/'>October 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/09/'>September 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/08/'>August 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/07/'>July 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/05/'>May 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/04/'>April 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/02/'>February 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2013/01/'>January 2013</a></li>
	<li><a href='https://6guts.wordpress.com/2012/11/'>November 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/10/'>October 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/09/'>September 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/08/'>August 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/07/'>July 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/06/'>June 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/05/'>May 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/04/'>April 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/03/'>March 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/02/'>February 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2012/01/'>January 2012</a></li>
	<li><a href='https://6guts.wordpress.com/2011/11/'>November 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/10/'>October 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/09/'>September 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/08/'>August 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/07/'>July 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/06/'>June 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/05/'>May 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/04/'>April 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/02/'>February 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2011/01/'>January 2011</a></li>
	<li><a href='https://6guts.wordpress.com/2010/11/'>November 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/10/'>October 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/09/'>September 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/08/'>August 2010</a></li>
	<li><a href='https://6guts.wordpress.com/2010/07/'>July 2010</a></li>
			</ul>

			</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>
			<ul>
					<li class="cat-item cat-item-1"><a href="https://6guts.wordpress.com/category/uncategorized/">Uncategorized</a>
</li>
			</ul>

			</li><li id="meta-2" class="widget-container widget_meta"><h3 class="widget-title">Meta</h3>
		<ul>
			<li><a href="https://wordpress.com/start?ref=wplogin">Register</a></li>			<li><a href="https://6guts.wordpress.com/wp-login.php">Log in</a></li>
			<li><a href="https://6guts.wordpress.com/feed/">Entries feed</a></li>
			<li><a href="https://6guts.wordpress.com/comments/feed/">Comments feed</a></li>

			<li><a href="https://wordpress.com/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.com</a></li>
		</ul>

		</li>			<div id="atatags-286348-6027b8bd564b8"></div>
			
			<script>
				__ATA.cmd.push(function() {
					__ATA.initDynamicSlot({
						id: 'atatags-286348-6027b8bd564b8',
						location: 140,
						formFactor: '003',
						label: {
							text: 'Advertisements',
						},
						creative: {
							reportAd: {
								text: 'Report this ad',
							},
							privacySettings: {
								text: 'Privacy',
								
							}
						}
					});
				});
			</script>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="site-info">
				<a href="https://6guts.wordpress.com/" title="6guts" rel="home">
					6guts				</a>
							</div><!-- #site-info -->

			<div id="site-generator">
								<a href="https://wordpress.com/?ref=footer_website" rel="nofollow">Create a free website or blog at WordPress.com.</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->

<!--  -->
<script src='//0.gravatar.com/js/gprofiles.js?ver=202106y' id='grofiles-cards-js'></script>
<script id='wpgroho-js-extra'>
var WPGroHo = {"my_hash":""};
</script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1610363240h'></script>

	<script>
		// Initialize and attach hovercards to all gravatars
		( function() {
			function init() {
				if ( typeof Gravatar === 'undefined' ) {
					return;
				}

				if ( typeof Gravatar.init !== 'function' ) {
					return;
				}

				Gravatar.profile_cb = function ( hash, id ) {
					WPGroHo.syncProfileData( hash, id );
				};

				Gravatar.my_hash = WPGroHo.my_hash;
				Gravatar.init( 'body', '#wp-admin-bar-my-account' );
			}

			if ( document.readyState !== 'loading' ) {
				init();
			} else {
				document.addEventListener( 'DOMContentLoaded', init );
			}
		} )();
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-c6b297bd0b0e9695ace8e3501aeca372">
	</div>
	<div class="grofile-hash-map-5999d5d26089eb4019867dc7705c41a9">
	</div>
	<div class="grofile-hash-map-5147bc9a113fad891146efe41b79f2d6">
	</div>
	<div class="grofile-hash-map-6428904bea03ecf54d864d2bf574a3a2">
	</div>
	</div>
<script id='highlander-comments-js-extra'>
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/6guts.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/6guts.wordpress.com\/wp-login.php?action=logout&_wpnonce=c0076cd1eb","homeURL":"https:\/\/6guts.wordpress.com\/","postID":"434","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"","text_direction":"ltr"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1573483029j'></script>
		<!-- CCPA [start] -->
		<script type="text/javascript">
			( function () {

				var setupPrivacy = function() {

					document.addEventListener( 'DOMContentLoaded', function() {

						// Minimal Mozilla Cookie library
						// https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie/Simple_document.cookie_framework
						var cookieLib = window.cookieLib = {getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,o,n,t,r,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var c="";if(n)switch(n.constructor){case Number:c=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:c="; expires="+n;break;case Date:c="; expires="+n.toUTCString()}return"rootDomain"!==r&&".rootDomain"!==r||(r=(".rootDomain"===r?".":"")+document.location.hostname.split(".").slice(-2).join(".")),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(o)+c+(r?"; domain="+r:"")+(t?"; path="+t:"")+(i?"; secure":""),!0}};

						var setDefaultOptInCookie = function() {
							var value = '1YNN';
							var domain = '.wordpress.com' === location.hostname.slice( -14 ) ? '.rootDomain' : location.hostname;
							cookieLib.setItem( 'usprivacy', value, 365 * 24 * 60 * 60, '/', domain );
						};

						var setCcpaAppliesCookie = function( value ) {
							var domain = '.wordpress.com' === location.hostname.slice( -14 ) ? '.rootDomain' : location.hostname;
							cookieLib.setItem( 'ccpa_applies', value, 24 * 60 * 60, '/', domain );
						}

						var maybeCallDoNotSellCallback = function() {
							if ( 'function' === typeof window.doNotSellCallback ) {
								return window.doNotSellCallback();
							}

							return false;
						}

						var usprivacyCookie = cookieLib.getItem( 'usprivacy' );

						if ( null !== usprivacyCookie ) {
							maybeCallDoNotSellCallback();
							return;
						}

						var ccpaCookie = cookieLib.getItem( 'ccpa_applies' );

						if ( null === ccpaCookie ) {

							var request = new XMLHttpRequest();
							request.open( 'GET', 'https://public-api.wordpress.com/geo/', true );

							request.onreadystatechange = function () {
								if ( 4 === this.readyState ) {
									if ( 200 === this.status ) {

										var data = JSON.parse( this.response );
										var ccpa_applies = data['region'] && data['region'].toLowerCase() === 'california';

										setCcpaAppliesCookie( ccpa_applies );

										if ( ccpa_applies ) {
											if ( maybeCallDoNotSellCallback() ) {
												setDefaultOptInCookie();
											}
										}
									} else {
										setCcpaAppliesCookie( true );
										if ( maybeCallDoNotSellCallback() ) {
											setDefaultOptInCookie();
										}
									}
								}
							};

							request.send();
						} else {
							if ( ccpaCookie === 'true' ) {
								if ( maybeCallDoNotSellCallback() ) {
									setDefaultOptInCookie();
								}
							}
						}
					} );
				};

				if ( window.defQueue && defQueue.isLOHP && defQueue.isLOHP === 2020 ) {
					defQueue.items.push( setupPrivacy );
				} else {
					setupPrivacy();
				}

			} )();
		</script>

		<!-- CCPA [end] -->
					<script type="text/javascript">
			( function( $ ) {
				$( document.body ).on( 'post-load', function () {
					if ( typeof __ATA.insertInlineAds === 'function' ) {
						__ATA.insertInlineAds();
					}
				} );
			} )( jQuery );
			</script>
<script>
window.addEventListener( "load", function( event ) {
	var link = document.createElement( "link" );
	link.href = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.css?v=20201002";
	link.type = "text/css";
	link.rel = "stylesheet";
	document.head.appendChild( link );

	var script = document.createElement( "script" );
	script.src = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.js?v=20201002";
	script.defer = true;
	document.body.appendChild( script );
} );
</script>

	
	<div id="carousel-reblog-box">
		<form action="#" name="carousel-reblog">
			<label for="carousel-reblog-content" id="carousel-reblog-lblogcontent" class="screen-reader-text">Add your thoughts here... (optional)</label>
			<textarea id="carousel-reblog-content" name="carousel-reblog-content" placeholder="Add your thoughts here... (optional)"></textarea>
			<label for="carousel-reblog-to-blog-id" id="carousel-reblog-lblogid">Post to</label>
			<select name="carousel-reblog-to-blog-id" id="carousel-reblog-to-blog-id">
						</select>

			<div class="submit">
				<span class="canceltext"><a href="#" class="cancel">Cancel</a></span>
				<input type="submit" name="carousel-reblog-submit" class="button" id="carousel-reblog-submit" value="Reblog Post" />
				<input type="hidden" id="carousel-reblog-blog-id" value="14597269" />
				<input type="hidden" id="carousel-reblog-blog-url" value="https://6guts.wordpress.com" />
				<input type="hidden" id="carousel-reblog-blog-title" value="6guts" />
				<input type="hidden" id="carousel-reblog-post-url" value="" />
				<input type="hidden" id="carousel-reblog-post-title" value="" />
			</div>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="73401afb46" /><input type="hidden" name="_wp_http_referer" value="/2016/04/15/heap-heap-hooray/" />		</form>

		<div class="arrow"></div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/6guts.wordpress.com\/2016\/04\/15\/heap-heap-hooray\/":434};
	</script>
				<div class="widget widget_eu_cookie_law_widget">
<div
	class="hide-on-button ads-active"
	data-hide-timeout="30"
	data-consent-expiration="180"
	id="eu-cookie-law"
>
	<form method="post">
		<input type="submit" value="Close and accept" class="accept" />

		Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br />
To find out more, including how to control cookies, see here:
				<a href="https://automattic.com/cookies" rel="nofollow">
			Cookie Policy		</a>
 </form>
</div>
</div><link rel='stylesheet' id='all-css-0-3' href='https://s0.wp.com/wp-content/mu-plugins/carousel/jetpack-carousel.css?m=1592560282h&cssminify=yes' type='text/css' media='all' />
<script id='jetpack-carousel-js-extra'>
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/6guts.wordpress.com\/wp-admin\/admin-ajax.php","nonce":"1c4c6e5266","display_exif":"1","display_comments":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/6guts.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2F6guts.wordpress.com%2F2016%2F04%2F15%2Fheap-heap-hooray%2F","blog_id":"14597269","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>","reblog":"Reblog","reblogged":"Reblogged","reblog_add_thoughts":"Add your thoughts here... (optional)","reblogging":"Reblogging...","post_reblog":"Post Reblog","stats_query_args":"blog=14597269&v=wpcom&tz=1&user_id=0&subd=6guts","is_public":"1","reblog_enabled":""};
</script>
<script id='sharing-js-js-extra'>
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFkd1OwzAMhV+I1BuVQLtAPAryEq9zmz/iZGV7+hmJXvCjcOXI55zPsgNrNjbFSrHCLODowpbyxzDLA3yXcpIaSAQn+kOd3xuV61cZOF6Y1n9tM9WMdjGFhG+/qKGZ7NvEUcDzQgIaanTG6DyVzczR+uZUVLhNIWhQcdlfh8CxQ1zZTVQFqKmaFibjcYVKIXus9KPf4aDTOeaIBQJKpaIvU4suJZ2QxZKakIftAFujN2hhCVTNOOzgTbeGUyqh4//8LnPyyAXkjIXjtFUNvYaX/dP+8XB43o3jfAfYjsCc'></script>
<script type='text/javascript'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20200826#ver=20200826' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="//stats.wp.com/w.js?61" defer></script> <script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'14597269','blog_tz':'1','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'14597269','v':'wpcom','tz':'1','user_id':'0','post':'434','subd':'6guts'}]);
_stq.push(['extra', {'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRY2gzcWhIRkllQ2l2Q3ZyRGZSdDFEZVhvNj1rNTdSdGl1aEhCQ3pnWlEmMnVtTXlIUlJbRStpdFg3SzUwS19ncCU9d216SH4zaXRUNlFwS3dbWnQ4fFJVKzBzN11kTG9BYzhlQnRrWllLZzJpK2hHOXMxZyxfTXUyTXhOSjIzdSYxMjM1MzJlW1s5U0c2MTNEMU9iNmExQ1ZPelh5djEsY1V0ZkJ2bEM/Zi5BWSYxMTFidW1yNXJCNG80MjAyZ3xCPVZELGxSbmJ2MXhPK3xLZnYzd0gvWX53Q1NzRS90cVoxOG1GX3ZrQy92Mk1+aGFQYQ=='}]);
_stq.push([ 'clickTrackerInit', '14597269', '434' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px;" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
