https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Day 22 &#8211; Testing Cro HTTP APIs | Raku Advent Calendar</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://perl6advent.wordpress.com/xmlrpc.php">

<script type="text/javascript">
  WebFontConfig = {"google":{"families":["Merriweather:r:latin,latin-ext","Merriweather:r,i,b,bi:latin,latin-ext"]}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active body, .wf-active button, .wf-active input, .wf-active select, .wf-active textarea{font-family:"Merriweather",serif}.wf-active blockquote{font-family:"Merriweather",serif}.wf-active .archive .format-quote blockquote, .wf-active .blog .format-quote blockquote{font-family:"Merriweather",serif}.wf-active .blog .format-quote blockquote cite, .wf-active .archive .format-quote blockquote cite{font-family:"Merriweather",serif}.wf-active #infinite-handle span{font-family:"Merriweather",serif}.wf-active h1{font-family:"Merriweather",serif;font-size:25.9px;font-weight:400;font-style:normal}.wf-active h2{font-family:"Merriweather",serif;font-size:22.4px;font-weight:400;font-style:normal}.wf-active h3{font-family:"Merriweather",serif;font-size:18.9px;font-weight:400;font-style:normal}.wf-active h4{font-family:"Merriweather",serif;font-size:16.1px;font-style:normal;font-weight:400}.wf-active h5{font-family:"Merriweather",serif;font-size:14px;font-style:normal;font-weight:400}.wf-active h6{font-family:"Merriweather",serif;font-size:11.2px;font-weight:400;font-style:normal}.wf-active .widget-area .widget-title{font-size:9.1px;font-family:"Merriweather",serif;font-weight:400;font-style:normal}.wf-active .page-header .page-title{font-family:"Merriweather",serif;font-size:10.5px;font-weight:400;font-style:normal}.wf-active .page-header .title-accent{font-family:"Merriweather",serif;font-size:0.875em;font-weight:400;font-style:normal}.wf-active .entry-title{font-family:"Merriweather",serif;font-size:18.2px;font-weight:400;font-style:normal}.wf-active .comments-title{font-family:"Merriweather",serif;font-size:1.82px;font-weight:400;font-style:normal}.wf-active .comment-reply-title{font-family:"Merriweather",serif;font-size:21px;font-weight:400;font-style:normal}.wf-active .site-title{font-family:"Merriweather",serif;font-size:18.2px;font-weight:400;font-style:normal}.wf-active .site-description{font-family:"Merriweather",serif;font-size:10.5px;font-weight:400;font-style:normal}@media screen and ( min-width: 789px ){.wf-active .site-title{font-size:21px;font-style:normal;font-weight:400}}@media screen and ( min-width: 789px ){.wf-active .site-description{font-size:11.9px;font-style:normal;font-weight:400}}@media screen and ( min-width: 789px ){.wf-active .entry-title{font-size:27.3px;font-style:normal;font-weight:400}}@media screen and ( min-width: 789px ){.wf-active .widget-area .widget-title{font-size:9.1px;font-style:normal;font-weight:400}}@media screen and ( min-width: 789px ){.wf-active comments-title{font-size:21px;font-style:normal;font-weight:400}}</style>
<meta name="google-site-verification" content="YPNxtMSK3Jj7JR2XCK-hDqmF9xDIeBEyvYm3aT1s71Y" />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel="alternate" type="application/rss+xml" title="Raku Advent Calendar &raquo; Feed" href="https://perl6advent.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Raku Advent Calendar &raquo; Comments Feed" href="https://perl6advent.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Raku Advent Calendar &raquo; Day 22 &#8211; Testing Cro HTTP&nbsp;APIs Comments Feed" href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s0.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1612197847h&ver=5.6.1"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s0.wp.com/_static/??-eJydkN0KgzAMhV9oNShz4MXYs7QaumpbS5NOfPvVwkD2x9hN4CTnSziBJYh+9oyewSURbNLGE0S0knEQYSZ+UlVPdID3mDUTEozIQfaTKOrF/vDqlKXCqPMkIty6qqsaUMnYAZSdC6+ijCsQrxZ/2FOo3Xm5zomFjmb4d0WUbLymD/gu+BYh912QvDkcDkaiRZdt37AlZEYoFSISiVydSU7wNYPlcRd3rk9109Zde2zGO9e+oL4=?cssminify=yes' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify {
	text-align:justify;
}
</style>
<link crossorigin="anonymous" rel='stylesheet' id='wilson-raleway-css'  href='https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&#038;ver=5.6.1' media='all' />
<link crossorigin="anonymous" rel='stylesheet' id='wilson-latos-css'  href='https://fonts.googleapis.com/css?family=Lato%3A400%2C700%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext&#038;ver=5.6.1' media='all' />
<link rel='stylesheet' id='all-css-4-1' href='https://s0.wp.com/_static/??-eJyNjlELwjAMhP+QNU6YzAfxt3Q11mjalDWl7N9b8WUwHL7dcXf5AjUZJ1ExKugDA2ZIZYRKnCVC1plx73LewaIXiklcPMUMHiNO1IIfcrVdMyi6L8fU5CRs0SrdPGoGLC2VF6FhW0ExJLbarv7xrhgWZ5UaeGnMnS1NW9MJRxbfpIfWWtjP6BouXX8+dKf+OAzPN2zjf80=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-5-1' href='https://s0.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<style id='jetpack-global-styles-frontend-style-inline-css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='all-css-8-1' href='https://s0.wp.com/_static/??-eJxti8sKgCAQAH8oW6KHdoi+xcTUWF1pjX4/OnSIOg0DM3BmYSgVmwrEQ2Q8XEgMmbiIFXXYgb3eQ3IPa8Ncwf/FZIJGgeToLZ+peBstg+/AIS0a72COU9OPUg69atV2AWWKN+I=?cssminify=yes' type='text/css' media='all' />
<script id='jetpack_related-posts-js-extra'>
var related_posts_js_options = {"post_heading":"h4"};
</script>
<script id='wpcom-actionbar-placeholder-js-extra'>
var actionbardata = {"siteID":"10740073","siteName":"Raku Advent Calendar","siteURL":"http:\/\/perl6advent.wordpress.com","icon":"<img alt='' src='https:\/\/s0.wp.com\/i\/logo\/wpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/wilson","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2Fperl6advent.wordpress.com%2F2018%2F12%2F22%2Fday-22-testing-cro-http-apis%2F&signup_flow=account","themeURL":"https:\/\/wordpress.com\/theme\/wilson\/","xhrURL":"https:\/\/perl6advent.wordpress.com\/wp-admin\/admin-ajax.php","nonce":"b4b36f611a","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"35335f14f8\" \/>","referer":"https:\/\/perl6advent.wordpress.com\/2018\/12\/22\/day-22-testing-cro-http-apis\/","canFollow":"1","feedID":"150402","statusMessage":"","customizeLink":"https:\/\/perl6advent.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fperl6advent.wordpress.com%2F2018%2F12%2F22%2Fday-22-testing-cro-http-apis%2F","postID":"7487","shortlink":"https:\/\/wp.me\/pJ3YZ-1WL","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/perl6advent.wordpress.com\/7487","statsLink":"https:\/\/wordpress.com\/stats\/post\/7487\/perl6advent.wordpress.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Wilson","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/read\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 128 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2Fperl6advent.wordpress.com%2F2018%2F12%2F22%2Fday-22-testing-cro-http-apis%2F&signup_flow=account\">Log in now.<\/a>","stats":"Stats"}};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFzdEKwjAMBdAfMiurMPFB/Ja5xZLSpLVpEP9+HSiILz6FezmXuGeBJUtDaS6q43yjhGCKdQ69A5J7HqIeXHckS7IVdYfxYVhf7zMwyV8ETKHODb/x5zMblGSBRF3F1NEKJWv7SX115cs4jf548ufJxw1oVkW8'></script>
<link rel='stylesheet' id='all-css-0-2' href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1530132353h&cssminify=yes' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s0.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://perl6advent.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s0.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/" />
<link rel='shortlink' href='https://wp.me/pJ3YZ-1WL' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2018%2F12%2F22%2Fday-22-testing-cro-http-apis%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2018%2F12%2F22%2Fday-22-testing-cro-http-apis%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Day 22 &#8211; Testing Cro HTTP APIs" />
<meta property="og:url" content="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/" />
<meta property="og:description" content="A good amount of my work time this year has been spent on building a couple of Perl 6 applications. After a decade of contributing to Perl 6 compiler and runtime development, it feels great to fina…" />
<meta property="article:published_time" content="2018-12-22T00:00:06+00:00" />
<meta property="article:modified_time" content="2018-12-22T08:05:21+00:00" />
<meta property="og:site_name" content="Raku Advent Calendar" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Day 22 &#8211; Testing Cro HTTP&nbsp;APIs" />
<meta name="twitter:image" content="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png" />
<meta name="twitter:card" content="summary" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s0.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://perl6advent.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://perl6advent.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://perl6advent.wordpress.com/osd.xml" title="Raku Advent Calendar" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
<meta name="application-name" content="Raku Advent Calendar" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Something cool about Raku (formerly known as Perl 6) every day" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://perl6advent.wordpress.com/feed/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s0.wp.com/i/favicon.ico" /><meta name="description" content="A good amount of my work time this year has been spent on building a couple of Perl 6 applications. After a decade of contributing to Perl 6 compiler and runtime development, it feels great to finally be using it to deliver production solutions solving real-world problems. I&#039;m still not sure whether writing code in&hellip;" />
<link rel="amphtml" href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/amp/"></head>

<body class="post-template-default single single-post postid-7487 single-format-standard customizer-styles-applied group-blog has-site-logo highlander-enabled highlander-light">
<div id="page" class="hfeed site">

	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
	<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
							<a href="https://perl6advent.wordpress.com/" class="site-logo-link" rel="home" itemprop="url"><img width="274" height="197" src="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png?w=274" class="site-logo attachment-wilson-site-logo" alt="" loading="lazy" data-size="wilson-site-logo" itemprop="logo" srcset="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png 274w, https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png?w=150 150w" sizes="(max-width: 274px) 100vw, 274px" data-attachment-id="2913" data-permalink="https://perl6advent.wordpress.com/cropped-camelia-small-santa1-png/" data-orig-file="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png" data-orig-size="274,197" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cropped-camelia-small-santa1.png" data-image-description="" data-medium-file="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png?w=274" data-large-file="https://perl6advent.files.wordpress.com/2015/11/cropped-camelia-small-santa1.png?w=274" /></a>						<h1 class="site-title"><a href="https://perl6advent.wordpress.com/" rel="home">Raku Advent Calendar</a></h1>
			<h2 class="site-description">Something cool about Raku (formerly known as Perl 6) every day</h2>
		</div>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h1><span class="screen-reader-text">Primary Menu</span></h1>
			<button class="menu-toggle"><span class="genericon genericon-menu"></span><span class="screen-reader-text">Menu</span></button>

			<div class="menu"><ul>
<li ><a href="https://perl6advent.wordpress.com/">Home</a></li><li class="page_item page-item-2"><a href="https://perl6advent.wordpress.com/about/">About</a></li>
</ul></div>
		</nav><!-- #site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-7487" class="post-7487 post type-post status-publish format-standard hentry category-2063728">
	<header class="entry-header">
					<h1 class="entry-title">Day 22 &#8211; Testing Cro HTTP&nbsp;APIs</h1>				<div class="entry-meta">
			<span class="posted-on"><a href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/" rel="bookmark"><time class="entry-date published" datetime="2018-12-22T01:00:06+00:00">December 22, 2018</time><time class="updated" datetime="2018-12-22T09:05:21+00:00">December 22, 2018</time></a></span><span class="byline"><span class="author vcard"><a class="url fn n" href="https://perl6advent.wordpress.com/author/jnthnwrthngtn/">jnthnwrthngtn</a></span></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>A good amount of my work time this year has been spent on building a couple of Perl 6 applications. After a decade of contributing to Perl 6 compiler and runtime development, it feels great to finally be using it to deliver production solutions solving real-world problems. I&#8217;m still not sure whether writing code in an <a href="http://www.commaide.com/" rel="nofollow">IDE</a> I founded, using a <a href="https://cro.services/" rel="nofollow">HTTP library</a> I designed, compiled by a <a href="https://rakudo.org/" rel="nofollow">compiler</a> I implemented large parts of, and running on a <a href="https://moarvm.org/" rel="nofollow">VM</a> that I play architect for, makes me one of the world&#8217;s worst cases of &#8220;Not Invented Here&#8221;, or just really Full Stack.</p>
<p>Whatever I&#8217;m working on, I highly value automated testing. Each passing test is something I know works &#8211; and something that I won&#8217;t break as I evolve the software in question. Even with automated tests, bugs happen, but adding a test to cover the bug at least means I&#8217;ll make <em>different</em> bugs in the future, which is perhaps a bit more forgivable.<br />
<span id="more-7487"></span><br />
Most of the code, and complexity, in the system I&#8217;m currently working on is in its domain objects. Those are reached through a HTTP API, implemented using Cro &#8211; and like the rest of the system, this HTTP API has automated tests. They use one old module of mine &#8211; <code>Test::Mock</code> &#8211; along with a new module released this year, <code>Cro::HTTP::Test</code>. In today&#8217;s advent post, I&#8217;ll discuss how I&#8217;ve been using them together, with results that I find quite pleasing.</p>
<h2><a id="user-content-a-sample-problem" class="anchor" href="#a-sample-problem" aria-hidden="true"></a>A sample problem</h2>
<p>It&#8217;s the advent calendar, so of course I need a sufficiently festive example problem. For me, one of the highlights of Christmas time in Central Europe is the Christmas markets, many set on beautiful historic city squares. And what, aside from sausage and mulled wine, do we need on that square? A tall, handsome Christmas tree, of course! But how to find the best tree? Well, we get the internet to help, by building a system where they can submit suggestions of trees they&#8217;ve seen that might be suitable. What could possibly go wrong?</p>
<p>One can PUT to a route <code>/trees/{latitude}/{longitude}</code> to submit a candidate tree at that location. The expected payload is a JSON blob with a tree <code>height</code>, and a text <code>description</code> of 10-200 characters explaining why the tree is so awesome. If a tree in the same location has already been submitted, a <code>409 Conflict</code> response should be returned. If the tree is accepted, then a simple <code>200 OK</code> response will be produced, with a JSON body describing the tree.</p>
<p>A GET of the same URI will return a description of the tree in question, while a GET to <code>/trees</code> will return the submitted trees, tallest first.</p>
<h2><a id="user-content-testability" class="anchor" href="#testability" aria-hidden="true"></a>Testability</h2>
<p>Back in highschool, science classes were certainly among my favorite. Now and then, we got to do experiments. Of course, each experiment needed writing up &#8211; both the planning before, the results, and an analysis of them. One of the most important parts of the planning was about how to ensure a &#8220;fair test&#8221;: how would we try control all of the things we weren&#8217;t trying to test, so that we could trust in our observations and draw conclusions from them?</p>
<p>Testing in software involves much the same thought process: how do we exercise the component(s) we&#8217;re interested in, while controlling the context they operate in? Sometimes, we get lucky, and we&#8217;re testing pure logic: it doesn&#8217;t depend on anything other than the things we give it to work with. In fact, we can <em>create our own luck</em> in this regard, spotting parts of our system that can be pure functions or immutable objects. To take examples from the current system I&#8217;m working on:</p>
<ul>
<li>We have an object model built up from a bunch of specification files.The process of building it is pretty involved, with a bunch of sanity checks, a few graph algorithms, and so forth. But the result is a bunch of <em>immutable objects</em>. Once constructed, they never change. Testing is easy: throw a bunch of test input in, and check that it builds the expected objects.</li>
<li>We have a small language with an evaluator. The data used by expressions in the language is passed in as an argument to the evaluator, and then we can check the result is what is expected. Thus, the evaluator is a <em>pure function</em>.</li>
</ul>
<p>So, the first thing to do for testability is to find the bits of the system that can be like this and build them that way. Alas, not all things are so simple. HTTP APIs are often a gateway to mutable state, database operations, and so forth. Further, a good HTTP API will map error conditions from the domain level into appropriate HTTP status codes. We&#8217;d like to be able to create such situations in our tests, so as to cover them. This is where a tool like <code>Test::Mock</code> comes in &#8211; but to use it, we need to factor our Cro service in a way that is test-friendly.</p>
<h2><a id="user-content-stubbing-a-service" class="anchor" href="#stubbing-a-service" aria-hidden="true"></a>Stubbing a service</h2>
<p>For those new to Cro, let&#8217;s take a look at the bare minimum we can write to get a HTTP service up and running, serving some fake data about trees.</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">use</span> Cro::HTTP::Router;
<span style="color:blue;">use</span> Cro::HTTP::Server;

<span style="color:blue;">my</span> $application <span style="color:blue;">=</span> route {
    <span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span> {
        content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, [
            {
                <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.4311548</span>,
                <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.586079</span>,
                <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.2</span>,
                <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Nice color, very bushy<span style="font-weight:bold;">'</span></span>
            },
            {
                <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
                <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
                <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">7.8</span>,
                <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Really tall and wide<span style="font-weight:bold;">'</span></span>
            },
        ]
    }
}

<span style="color:blue;">my</span> $server <span style="color:blue;">=</span> Cro::HTTP::Server<span style="color:blue;">.</span><span style="color:#449;">new</span>(<span style="color:blue;">:</span>port(<span style="color:#449;">10000</span>), <span style="color:blue;">:</span>$application);
$server<span style="color:blue;">.</span>start;
<span style="color:blue;">react</span> <span style="color:blue;">whenever</span> signal(SIGINT) {
    $server<span style="color:blue;">.</span>stop;
    <span style="color:blue;">exit</span>;
}</pre>
</div>
<p>This isn&#8217;t a great setup for being able to test our routes, however. Better would be to put the routes into a subroutine in a module <code>lib/BestTree.pm6</code>:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">unit <span style="color:blue;">module</span> <span class="pl-en">BestTree</span>;
<span style="color:blue;">use</span> Cro::HTTP::Router;

<span style="color:blue;">sub</span> routes() <span style="color:blue;">is</span> <span class="pl-en">export</span> {
    route {
        <span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span> {
            content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, [
                {
                    <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.4311548</span>,
                    <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.586079</span>,
                    <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.2</span>,
                    <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Nice color, very bushy<span style="font-weight:bold;">'</span></span>
                },
                {
                    <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
                    <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
                    <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">7.8</span>,
                    <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Really tall and wide<span style="font-weight:bold;">'</span></span>
                },
            ]
        }
    }
}</pre>
</div>
<p>And use it from the script:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">use</span> BestTree;
<span style="color:blue;">use</span> Cro::HTTP::Server;

<span style="color:blue;">my</span> $application <span style="color:blue;">=</span> routes();
<span style="color:blue;">my</span> $server <span style="color:blue;">=</span> Cro::HTTP::Server<span style="color:blue;">.</span><span style="color:#449;">new</span>(<span style="color:blue;">:</span>port(<span style="color:#449;">10000</span>), <span style="color:blue;">:</span>$application);
$server<span style="color:blue;">.</span>start;
<span style="color:blue;">react</span> <span style="color:blue;">whenever</span> signal(SIGINT) {
    $server<span style="color:blue;">.</span>stop;
    <span style="color:blue;">exit</span>;
}</pre>
</div>
<p>Now, if we had something that could be used to test that <code>route</code> blocks do the right thing, we could <code>use</code> this module, and get on with our testing.</p>
<h2><a id="user-content-stores-models-etc" class="anchor" href="#stores-models-etc" aria-hidden="true"></a>Stores, models, etc.</h2>
<p>There&#8217;s another problem, however. Our Christmas tree service will be stashing the tree information away in some database, as well as enforcing the various rules. Where should this logic go?</p>
<p>There&#8217;s many ways we might choose to arrange this code, but the key thing is that this logic does <em>not</em> belong in our Cro route handlers. Their job is to map between the domain objects and the world of HTTP, for example turning domain exceptions into appropriate HTTP error responses. That mapping is what we&#8217;ll want to test.</p>
<p>So, before we continue, let&#8217;s define how some of those things look. We&#8217;ll have a <code>BestTree::Tree</code> class that represents a tree:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">class</span> <span class="pl-en">BestTree::Tree</span> {
    <span style="color:blue;">has</span> <span style="color:#449;">Rat</span> $.latitude;
    <span style="color:blue;">has</span> <span style="color:#449;">Rat</span> $.longitude;
    <span style="color:blue;">has</span> <span style="color:#449;">Rat</span> $.height;
    <span style="color:blue;">has</span> <span style="color:#449;">Str</span> $.description;
}</pre>
</div>
<p>And we&#8217;ll work with a <code>BestTree::Store</code> object. We won&#8217;t actually implement this as part of this post; it will be what we fake in our tests.</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">class</span> <span class="pl-en">BestTree::Store</span> {
    <span style="color:blue;">method</span> all-trees() { <span style="color:blue;">...</span> }
    <span style="color:blue;">method</span> suggest-tree(BestTree::Tree $<span style="color:#449;">tree</span> <span style="color:blue;">--&gt;</span> <span style="color:#449;">Nil</span>) { <span style="color:blue;">...</span> }
    <span style="color:blue;">method</span> find-tree(<span style="color:#449;">Rat</span> $latitude, <span style="color:#449;">Rat</span> $longitude <span style="color:blue;">--&gt;</span> BestTree::Tree) { <span style="color:blue;">...</span> }
}</pre>
</div>
<p>But how can we arrange things so we can take control of the store that is used by the routes, for testing purposes? One easy way is to make it a parameter to our <code>routes</code> subroutine, meaning it will be available in the <code>route</code> block:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">sub</span> routes(BestTree::Store $store) <span style="color:blue;">is</span> <span class="pl-en">export</span> {
    <span style="color:blue;">...</span>
}</pre>
</div>
<p>This is a functional factoring. Some folks may prefer to use some kind of OO-based Dependency Injection, using some kind of container. That can work fine with Cro too: just have a method that returns the <code>route</code> block. (If building something non-tiny with Cro, check out the <a href="https://cro.services/docs/structuring-services" rel="nofollow">documentation on structuring services</a> for some further advice on this front.)</p>
<h2><a id="user-content-getting-a-list-of-trees" class="anchor" href="#getting-a-list-of-trees" aria-hidden="true"></a>Getting a list of trees</h2>
<p>Now we&#8217;re ready to start writing tests! Let&#8217;s stub the test file:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">use</span> BestTree;
<span style="color:blue;">use</span> BestTree::Store;
<span style="color:blue;">use</span> Cro::HTTP::Test;
<span style="color:blue;">use</span> <span style="color:#449;">Test</span>::Mock;
<span style="color:blue;">use</span> <span style="color:#449;">Test</span>;

<span style="color:#999;"><span style="color:#999;">#</span> Tests will go here</span>

<span style="color:#449;">done-testing</span>;</pre>
</div>
<p>We use <code>BestTree</code>, which contains the routes we want to test, along with:</p>
<ul>
<li><code>Cro::HTTP::Test</code>, which we will use to easily write tests for our routes</li>
<li><code>Test::Mock</code>, which we&#8217;ll use to fake the store</li>
<li><code>Test</code>, which we don&#8217;t strictly need, but having access to <code>subtest</code> will<br />
let us produce more organized test output</li>
</ul>
<p>Next, we&#8217;ll make a couple of tree objects to use in our tests:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:blue;">my</span> $fake-tree-a <span style="color:blue;">=</span> BestTree::Tree<span style="color:blue;">.</span><span style="color:#449;">new</span><span style="color:blue;">:</span>
        <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.4311548</span>,
        <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.586079</span>,
        <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.2</span>,
        <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Nice color, very bushy<span style="font-weight:bold;">'</span></span>;
<span style="color:blue;">my</span> $fake-tree-b <span style="color:blue;">=</span> BestTree::Tree<span style="color:blue;">.</span><span style="color:#449;">new</span><span style="color:blue;">:</span>
        <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
        <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
        <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">7.8</span>,
        <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Really tall and wide<span style="font-weight:bold;">'</span></span>;</pre>
</div>
<p>And here comes the first test:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">subtest <span style="color:#994;"><span style="font-weight:bold;">'</span>Get all trees<span style="font-weight:bold;">'</span></span> <span style="color:blue;">=&gt;</span> {
    <span style="color:blue;">my</span> $fake-store <span style="color:blue;">=</span> mocked BestTree::Store, <span style="color:#994;">returning </span><span style="color:blue;">=&gt;</span> {
        <span style="color:#994;">all-trees </span><span style="color:blue;">=&gt;</span> [$fake-tree-a, $fake-tree-b]
    };
    test-service routes($fake-store), {
        test <span style="color:#449;">get</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees<span style="font-weight:bold;">'</span></span>),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">200</span>,
                <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> [
                    {
                        <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.4311548</span>,
                        <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.586079</span>,
                        <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.2</span>,
                        <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Nice color, very bushy<span style="font-weight:bold;">'</span></span>
                    },
                    {
                        <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
                        <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
                        <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">7.8</span>,
                        <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Really tall and wide<span style="font-weight:bold;">'</span></span>
                    }
                ];
        check-mock $fake-store,
                <span style="color:blue;">*.</span>called(<span style="color:#994;"><span style="font-weight:bold;">'</span>all-trees<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">times </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">1</span>, <span style="color:blue;">with</span> <span style="color:blue;">=&gt;</span> \());
    }
}</pre>
</div>
<p>First, we make a fake of <code>BestTree::Store</code> that, whenever <code>all-trees</code> is called, will return the fake data we specify. We then use <code>test-service</code>, passing in the <code>route</code> block created with the fake store. All <code>test</code> calls within the block that follows will be executed against that <code>route</code> block.</p>
<p>Notice that we don&#8217;t need to worry about running a HTTP server here to host the routes we want to test. In fact, due to the pipeline architecture of Cro, it&#8217;s easily possible for us to take the Cro HTTP client, wire its TCP message output to put the data it would send into a Perl 6 <code>Channel</code>, and then have that data pushed into the server pipeline&#8217;s TCP message input pipeline, and vice versa. This means that we test things all the way down to the bytes that are sent and received, but without actually having to hit even the local network stack. (Aside: you can also use <code>Cro::HTTP::Test</code> with a URI, which means if you really wanted to spin up a test server, or even wanted to write tests against some other service running in a different process, you could do it.)</p>
<p>The <code>test</code> routine specifies a test case. Its first argument describes the request that we wish to perform &#8211; in this case, a <code>get</code> to <code>/trees</code>. The named arguments then specify how the response should look. The <code>status</code> check ensures we get the expected HTTP status code back. The <code>json</code> check is really two in one:</p>
<ul>
<li>It checks that the HTTP content-type is a JSON one</li>
<li>It checks that the body deserializes to the supplied JSON (if you don&#8217;t want to<br />
test every single piece of it, pass a block there, which should evaluate to <code>True</code>)</li>
</ul>
<p>If that&#8217;s all we did, and we ran our tests, we&#8217;d find they mysteriously pass, even though we didn&#8217;t yet edit our <code>route</code> block&#8217;s <code>get</code> handler to actually use the store! Why? Because it turns out I was lazy and used the data from my earlier little server example as my test data here. No worries, though: to make the test stronger, we can add a call to <code>check-mock</code>, and then assert that our fake store really did have the <code>all-trees</code> method called once, and with no arguments passed.</p>
<p>That just leaves us to make the test pass, by implementing the handler properly:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span> {
    content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, [
        $store<span style="color:blue;">.</span>all-trees<span style="color:blue;">.</span><span style="color:#449;">map</span><span style="color:blue;">:</span> <span style="color:blue;">-&gt;</span> $<span style="color:#449;">tree</span> {
            {
                <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>latitude,
                <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>longitude,
                <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>height,
                <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>description
            }
        }
    ]
}</pre>
</div>
<h2><a id="user-content-getting-a-tree" class="anchor" href="#getting-a-tree" aria-hidden="true"></a>Getting a tree</h2>
<p>Time for the next test: getting a tree. There are two cases to consider here: the one where the tree is found, and the one where the tree is not found. Here&#8217;s a test for the case where a tree is found:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">subtest <span style="color:#994;"><span style="font-weight:bold;">'</span>Get a tree that exists<span style="font-weight:bold;">'</span></span> <span style="color:blue;">=&gt;</span> {
    <span style="color:blue;">my</span> $fake-store <span style="color:blue;">=</span> mocked BestTree::Store, <span style="color:#994;">returning </span><span style="color:blue;">=&gt;</span> {
        <span style="color:#994;">find-tree </span><span style="color:blue;">=&gt;</span> $fake-tree-b
    };
    test-service routes($fake-store), {
        test <span style="color:#449;">get</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">200</span>,
                <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> {
                    <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
                    <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
                    <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">7.8</span>,
                    <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Really tall and wide<span style="font-weight:bold;">'</span></span>
                };
        check-mock $fake-store,
                <span style="color:blue;">*.</span>called(<span style="color:#994;"><span style="font-weight:bold;">'</span>find-tree<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">times </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">1</span>, <span style="color:blue;">with</span> <span style="color:blue;">=&gt;</span> \(<span style="color:#449;">50.5466504</span>, <span style="color:#449;">14.8438714</span>));
    }
}</pre>
</div>
<p>Running this now fails. In fact, the <code>status</code> code check fails first, because we didn&#8217;t implement the route yet, and so get 404 back, not the expected 200. So, here&#8217;s an implementation to make it pass:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">        <span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span>, <span style="color:#449;">Rat</span>() $latitude, <span style="color:#449;">Rat</span>() $longitude {
            <span style="color:blue;">given</span> $store<span style="color:blue;">.</span>find-tree($latitude, $longitude) <span style="color:blue;">-&gt;</span> $<span style="color:#449;">tree</span> {
                content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, {
                    <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>latitude,
                    <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>longitude,
                    <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>height,
                    <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>description
                }
            }
        }</pre>
</div>
<p>Part of this looks somewhat familiar from the other route, no? So, with two passing tests, let&#8217;s go forth and refactor:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span> {
    content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>,
            [$store<span style="color:blue;">.</span>all-trees<span style="color:blue;">.</span><span style="color:#449;">map</span>(&amp;tree-for-json)];
}

<span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span>, <span style="color:#449;">Rat</span>() $latitude, <span style="color:#449;">Rat</span>() $longitude {
    <span style="color:blue;">given</span> $store<span style="color:blue;">.</span>find-tree($latitude, $longitude) <span style="color:blue;">-&gt;</span> $<span style="color:#449;">tree</span> {
        content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, tree-for-json($<span style="color:#449;">tree</span>);
    }
}

<span style="color:blue;">sub</span> tree-for-json(BestTree::Tree $<span style="color:#449;">tree</span> <span style="color:blue;">--&gt;</span> <span style="color:#449;">Hash</span>) {
    <span style="color:blue;">return</span> {
        <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>latitude,
        <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>longitude,
        <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>height,
        <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> $<span style="color:#449;">tree</span><span style="color:blue;">.</span>description
    }
}</pre>
</div>
<p>And the tests pass, and we know our refactor is good. But wait, what about if there is no tree there? In that case, the store will return <code>Nil</code>. We&#8217;d like to map that into a 404. Here&#8217;s another test:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">subtest <span style="color:#994;"><span style="font-weight:bold;">'</span>Get a tree that does not exist<span style="font-weight:bold;">'</span></span> <span style="color:blue;">=&gt;</span> {
    <span style="color:blue;">my</span> $fake-store <span style="color:blue;">=</span> mocked BestTree::Store, <span style="color:#994;">returning </span><span style="color:blue;">=&gt;</span> {
        <span style="color:#994;">find-tree </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">Nil</span>
    };
    test-service routes($fake-store), {
        test <span style="color:#449;">get</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">404</span>;
        check-mock $fake-store,
                <span style="color:blue;">*.</span>called(<span style="color:#994;"><span style="font-weight:bold;">'</span>find-tree<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">times </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">1</span>, <span style="color:blue;">with</span> <span style="color:blue;">=&gt;</span> \(<span style="color:#449;">50.5466504</span>, <span style="color:#449;">14.8438714</span>));
    }
}</pre>
</div>
<p>Which fails, in fact, with a 500 error, since we didn&#8217;t consider that case in our route block. Happily, this one is easy to deal with: turn out <code>given</code> into a <code>with</code>, which checks we got a defined object, and then add an <code>else</code> and produce the 404 Not Found response.</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:#449;">get</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span>, <span style="color:#449;">Rat</span>() $latitude, <span style="color:#449;">Rat</span>() $longitude {
    <span style="color:blue;">with</span> $store<span style="color:blue;">.</span>find-tree($latitude, $longitude) <span style="color:blue;">-&gt;</span> $<span style="color:#449;">tree</span> {
        content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, tree-for-json($<span style="color:#449;">tree</span>);
    }
    <span style="color:blue;">else</span> {
        not-found;
    }
}</pre>
</div>
<h2><a id="user-content-submitting-a-tree" class="anchor" href="#submitting-a-tree" aria-hidden="true"></a>Submitting a tree</h2>
<p>Last but not least, let&#8217;s test the route for suggesting a new tree. Here&#8217;s the successful case:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">subtest <span style="color:#994;"><span style="font-weight:bold;">'</span>Suggest a tree successfully<span style="font-weight:bold;">'</span></span> <span style="color:blue;">=&gt;</span> {
    <span style="color:blue;">my</span> $fake-store <span style="color:blue;">=</span> mocked BestTree::Store;
    test-service routes($fake-store), {
        <span style="color:blue;">my</span> <span style="color:blue;">%</span><span style="color:#449;">body</span> <span style="color:blue;">=</span> <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Awesome tree<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.25</span>;
        test <span style="color:#449;">put</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> <span style="color:blue;">%</span><span style="color:#449;">body</span>),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">200</span>,
                <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> {
                    <span style="color:#994;">latitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">50.5466504</span>,
                    <span style="color:#994;">longitude </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">14.8438714</span>,
                    <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.25</span>,
                    <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Awesome tree<span style="font-weight:bold;">'</span></span>
                };
        check-mock $fake-store,
                <span style="color:blue;">*.</span>called(<span style="color:#994;"><span style="font-weight:bold;">'</span>suggest-tree<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">times </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">1</span>, <span style="color:blue;">with</span> <span style="color:blue;">=&gt;</span> <span style="color:blue;">:</span>(
                    BestTree::Tree $<span style="color:#449;">tree</span> <span style="color:blue;">where</span> {
                        <span style="color:blue;">.</span>latitude <span style="color:blue;">==</span> <span style="color:#449;">50.5466504</span> <span style="color:blue;">&amp;&amp;</span>
                        <span style="color:blue;">.</span>longitude <span style="color:blue;">==</span> <span style="color:#449;">14.8438714</span> <span style="color:blue;">&amp;&amp;</span>
                        <span style="color:blue;">.</span>height <span style="color:blue;">==</span> <span style="color:#449;">4.25</span> <span style="color:blue;">&amp;&amp;</span>
                        <span style="color:blue;">.</span>description <span style="color:blue;">eq</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Awesome tree<span style="font-weight:bold;">'</span></span>
                    }
                ));
    }
}</pre>
</div>
<p>This is mostly familiar, except the <code>check-mock</code> call looks a little different this time. <code>Test::Mock</code> lets us test the arguments in two different ways: with a <code>Capture</code> (as we&#8217;ve done so far) or with a <code>Signature</code>. The <code>Capture</code> case is great for all of the simple cases, where we&#8217;re just dealing with boring values. However, once we get in to reference types, or if we don&#8217;t actually care about exact values and just want to assert the things we care about, a signature gives us the flexibility to do that. Here, we use a <code>where</code> clause to check that the tree object that the route handler has constructed contains the expected data.</p>
<p>Here&#8217;s the route handler that does just that:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:#449;">put</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span>, <span style="color:#449;">Rat</span>() $latitude, <span style="color:#449;">Rat</span>() $longitude {
    request-body <span style="color:blue;">-&gt;</span> (<span style="color:#449;">Rat</span>(<span style="color:#449;">Real</span>) <span style="color:blue;">:</span>$height<span style="color:blue;">!</span>, <span style="color:#449;">Str</span> <span style="color:blue;">:</span>$description<span style="color:blue;">!</span>) {
        <span style="color:blue;">my</span> $<span style="color:#449;">tree</span> <span style="color:blue;">=</span> BestTree::Tree<span style="color:blue;">.</span><span style="color:#449;">new</span><span style="color:blue;">:</span> <span style="color:blue;">:</span>$latitude, <span style="color:blue;">:</span>$longitude,
                <span style="color:blue;">:</span>$height, <span style="color:blue;">:</span>$description;
        $store<span style="color:blue;">.</span>suggest-tree($<span style="color:#449;">tree</span>);
        content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, tree-for-json($<span style="color:#449;">tree</span>);
    }
}</pre>
</div>
<p>Notice how Cro lets us use Perl 6 signatures to destructure the request body. In one line, we&#8217;ve said:</p>
<ul>
<li>The request body must have height and description</li>
<li>That we want the height to be a <code>Real</code> number</li>
<li>That we want the description to be a string</li>
</ul>
<p>Should any of those fail, Cro will automatically produce a 400 bad request for us. In fact, we can write tests to cover that &#8211; along with a new test to make sure a conflict will result in a 409.</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;">subtest <span style="color:#994;"><span style="font-weight:bold;">'</span>Problems suggesting a tree<span style="font-weight:bold;">'</span></span> <span style="color:blue;">=&gt;</span> {
    <span style="color:blue;">my</span> $fake-store <span style="color:blue;">=</span> mocked BestTree::Store, <span style="color:#994;">computing </span><span style="color:blue;">=&gt;</span> {
        <span style="color:#994;">suggest-tree </span><span style="color:blue;">=&gt;</span> {
            <span style="color:blue;">die</span> <span style="color:#449;">X::BestTree::Store::AlreadySuggested</span><span style="color:blue;">.</span><span style="color:#449;">new</span>;
        }
    }
    test-service routes($fake-store), {
        <span style="color:#999;"><span style="color:#999;">#</span> Missing or bad data.</span>
        test <span style="color:#449;">put</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> {}),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">400</span>;
        <span style="color:blue;">my</span> <span style="color:blue;">%</span>bad-body <span style="color:blue;">=</span> <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>ok<span style="font-weight:bold;">'</span></span>;
        test <span style="color:#449;">put</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> <span style="color:blue;">%</span>bad-body),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">400</span>;
        <span style="color:blue;">%</span>bad-body&lt;<span style="color:#994;">height</span>&gt; <span style="color:blue;">=</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>grinch<span style="font-weight:bold;">'</span></span>;
        test <span style="color:#449;">put</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> <span style="color:blue;">%</span>bad-body),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">400</span>;

        <span style="color:#999;"><span style="color:#999;">#</span> Conflict.</span>
        <span style="color:blue;">my</span> <span style="color:blue;">%</span><span style="color:#449;">body</span> <span style="color:blue;">=</span> <span style="color:#994;">description </span><span style="color:blue;">=&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>Awesome tree<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">height </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">4.25</span>;
        test <span style="color:#449;">put</span>(<span style="color:#994;"><span style="font-weight:bold;">'</span>/trees/50.5466504/14.8438714<span style="font-weight:bold;">'</span></span>, <span style="color:#994;">json </span><span style="color:blue;">=&gt;</span> <span style="color:blue;">%</span><span style="color:#449;">body</span>),
                <span style="color:#994;">status </span><span style="color:blue;">=&gt;</span> <span style="color:#449;">409</span>;
    }
}</pre>
</div>
<p>The main new thing here is that we&#8217;re using <code>computing</code> instead of <code>returning</code> with <code>mocked</code>. In this case, we pass a block, and it will be executed. (The block does not get the method arguments, however. If we want to get those, there is a third option, <code>overriding</code>, where we get to take the arguments and write a fake method body.)</p>
<p>And how to handle this? By making our route handler catch and map the typed exception:</p>
<div class="highlight highlight-source-perl6fe">
<pre style="font-size:14px;font-family:monospace;"><span style="color:#449;">put</span> <span style="color:blue;">-&gt;</span> <span style="color:#994;"><span style="font-weight:bold;">'</span>trees<span style="font-weight:bold;">'</span></span>, <span style="color:#449;">Rat</span>() $latitude, <span style="color:#449;">Rat</span>() $longitude {
    request-body <span style="color:blue;">-&gt;</span> (<span style="color:#449;">Rat</span>(<span style="color:#449;">Real</span>) <span style="color:blue;">:</span>$height<span style="color:blue;">!</span>, <span style="color:#449;">Str</span> <span style="color:blue;">:</span>$description<span style="color:blue;">!</span>) {
        <span style="color:blue;">my</span> $<span style="color:#449;">tree</span> <span style="color:blue;">=</span> BestTree::Tree<span style="color:blue;">.</span><span style="color:#449;">new</span><span style="color:blue;">:</span> <span style="color:blue;">:</span>$latitude, <span style="color:blue;">:</span>$longitude,
                <span style="color:blue;">:</span>$height, <span style="color:blue;">:</span>$description;
        $store<span style="color:blue;">.</span>suggest-tree($<span style="color:#449;">tree</span>);
        content <span style="color:#994;"><span style="font-weight:bold;">'</span>application/json<span style="font-weight:bold;">'</span></span>, tree-for-json($<span style="color:#449;">tree</span>);
        <span style="color:blue;">CATCH</span> {
            <span style="color:blue;">when</span> <span style="color:#449;">X::BestTree::Store::AlreadySuggested</span> {
                conflict;
            }
        }
    }
}</pre>
</div>
<h2><a id="user-content-closing-thoughts" class="anchor" href="#closing-thoughts" aria-hidden="true"></a>Closing thoughts</h2>
<p>With <code>Cro::HTTP::Test</code>, there&#8217;s now a nice way to write HTTP tests in Perl 6. Put together with a testable design, and perhaps a module like <code>Test::Mock</code>, we can also isolate our Cro route handlers from everything else, easing their testing.</p>
<p>The logic in our route handlers here is relatively straightforward; small sample problems usually are. Even here, however, I find there&#8217;s value in the journey, rather than only in the destination. The act of writing tests for a HTTP API puts me in the frame of mind of whoever will be calling the API, which can be a useful perspective to have. Experience also tells that tests &#8220;too simple to fail&#8221; do end up catching mistakes: the kinds of mistakes I might assume I&#8217;m too smart to make. Discipline goes a long way. On which note, I&#8217;ll now be disciplined about taking a break from the keyboard now and then, and go enjoy a Christmas market. -Ofun!</p>
<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-7487" class="share-twitter sd-button share-icon" href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-7487" class="share-facebook sd-button share-icon" href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-10740073-7487-602965162779a' data-src='//widgets.wp.com/likes/index.html?ver=20200826#blog_id=10740073&amp;post_id=7487&amp;origin=perl6advent.wordpress.com&amp;obj_id=10740073-7487-602965162779a' data-name='like-post-frame-10740073-7487-602965162779a'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>			</div><!-- .entry-content -->

	<footer class="entry-footer">
				<span class="cat-links">
			Categories: <a href="https://perl6advent.wordpress.com/category/2018/" rel="category tag">2018</a>		</span>
		
			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

				<nav class="navigation post-navigation" role="navigation">
		<h1 class="screen-reader-text">Post navigation</h1>
		<div class="nav-links">
			<div class="nav-previous"><a href="https://perl6advent.wordpress.com/2018/12/21/day-21-a-red-secret-santa/" rel="prev"><span class="meta-nav">&larr;</span> Day 21 &#8211; A Red Secret&nbsp;Santa</a></div><div class="nav-next"><a href="https://perl6advent.wordpress.com/2018/12/23/day-23-blin-its-christmas-soon/" rel="next">Day 23 – Blin, it&#8217;s Christmas&nbsp;soon! <span class="meta-nav">&rarr;</span></a></div>		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			2 thoughts on &ldquo;<span>Day 22 &#8211; Testing Cro HTTP&nbsp;APIs</span>&rdquo;		</h2>

		
		<ol class="comment-list">
					<li id="comment-22111" class="comment byuser comment-author-cxwinnectaland even thread-even depth-1 highlander-comment">
			<article id="div-comment-22111" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://0.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=50&#038;d=identicon&#038;r=G' class='avatar avatar-50' height='50' width='50' />						<b class="fn"><a href='http://devwrench.wordpress.com' rel='external nofollow ugc' class='url'>cxw</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/#comment-22111"><time datetime="2018-12-23T13:32:14+00:00">December 23, 2018 at 13:32</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>NIH vs. full stack?  Both.  Definitely both. :D :D  Keep up the awesome work!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://perl6advent.wordpress.com/2018/12/22/day-22-testing-cro-http-apis/?replytocom=22111#respond' data-commentid="22111" data-postid="7487" data-belowelement="div-comment-22111" data-respondelement="respond" data-replyto="Reply to cxw" aria-label='Reply to cxw'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
		<li id="comment-22118" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
			<div class="comment-body">
				Pingback: <a href='https://p6weekly.wordpress.com/2018/12/24/2018-52-three-years-later/' rel='external nofollow ugc' class='url'>2018.52 Three Years Later | Weekly changes in and around Perl 6</a> 			</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2018/12/22/day-22-testing-cro-http-apis/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://perl6advent.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="ef994ced00" /><input type="hidden" name="_wp_http_referer" value="/2018/12/22/day-22-testing-cro-http-apis/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">
	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" class="nascar-signin-link"
                   title="Login via Guest">
									</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" class="nascar-signin-link"
                   title="Login via WordPress.com">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg>				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2Fperl6advent.wordpress.com&#038;color_scheme=light" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" class="nascar-signin-link"
                   title="Login via Twitter">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg>				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" class="nascar-signin-link"
                   title="Login via Facebook">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg>				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url" value="" /></div>
				</div>
			</div>
			
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
						<p class="comment-form-posting-as pa-wordpress">
			<strong></strong>
			You are commenting using your WordPress.com account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
						<p class="comment-form-posting-as pa-googleplus">
			<strong></strong>
			You are commenting using your Google account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" x="0px" y="0px" viewBox="0 0 60 60" ><path fill="#519bf7" d="M56.3,30c0,-1.6 -0.2,-3.4 -0.6,-5h-3.1H42.2H30v10.6h14.8C44,39.3 42,42 39.1,43.9l8.8,6.8C53,46 56.3,39 56.3,30z" /><path fill="#3db366" d="M30,57.5c6.7,0 13.1,-2.4 17.9,-6.8l-8.8,-6.8c-2.5,1.6 -5.6,2.4 -9.1,2.4c-7.2,0 -13.3,-4.7 -15.4,-11.2l-9.3,7.1C9.8,51.3 19.1,57.5 30,57.5z" /><path fill="#fdc600" d="M5.3,42.2l9.3,-7.1c-0.5,-1.6 -0.8,-3.3 -0.8,-5.1s0.3,-3.5 0.8,-5.1l-9.3,-7.1C3.5,21.5 2.5,25.6 2.5,30S3.5,38.5 5.3,42.2z" /><path fill="#f15b44" d="M40.1,17.4l8,-8C43.3,5.1 37,2.5 30,2.5C19.1,2.5 9.8,8.7 5.3,17.8l9.3,7.1c2.1,-6.5 8.2,-11.1 15.4,-11.1C33.9,13.7 37.4,15.1 40.1,17.4z" /></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
						<p class="comment-form-posting-as pa-twitter">
			<strong></strong>
			You are commenting using your Twitter account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
						<p class="comment-form-posting-as pa-facebook">
			<strong></strong>
			You are commenting using your Facebook account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function () {

	function hide( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.setProperty( 'display', 'none' );
		}
	}

	function show( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.removeProperty( 'display' );
		}
	}

	var input = document.createElement( 'input' );
	var comment = document.querySelector( '#comment' );

	if ( input && comment && 'placeholder' in input ) {
		var label = document.querySelector( '.comment-textarea label' );
		if ( label ) {
			var text = label.textContent;
			label.parentNode.removeChild( label );
			comment.setAttribute( 'placeholder', text );
		}
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	hide( '#comment-form-identity' );
	hide( '#comment-form-subscribe' );
	hide( '#commentform .form-submit' );

	if ( comment ) {
		comment.style.height = '10px';

		var handler = function () {
			comment.style.height = HighlanderComments.initialHeight + 'px';
			show( '#comment-form-identity' );
			show( '#comment-form-subscribe' );
			show( '#commentform .form-submit' );
			HighlanderComments.resizeCallback();

			comment.removeEventListener( 'focus', handler );
		};

		comment.addEventListener( 'focus', handler );
	}
}

if ( document.readyState !== 'loading' ) {
	highlander_expando_javascript();
} else {
	if ( typeof window.jQuery === 'function' ) {
		// Use jQuery's `ready` if available.
		// This solves some scheduling issues between this script and the main highlander script.
		jQuery( document ).ready( highlander_expando_javascript );
	} else {
		// If not available, add a vanilla event listener.
		document.addEventListener( 'DOMContentLoaded', highlander_expando_javascript );
	}
}

</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p><p class="post-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog"  style="display: inline;">Notify me of new posts via email.</label></p></div>




<p class="form-submit"><input name="submit" type="submit" id="comment-submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='7487' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="1e8cae8e4c" /></p>
<input type="hidden" name="genseq" value="1613325590" />
<input type="hidden" id="ak_js" name="ak_js" value="115"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	<div style="clear: both"></div><p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->

	<div id="secondary" class="widget-area" role="complementary">
		
					<aside id="calendar-10" class="widget widget_calendar"><div id="calendar_wrap" class="calendar_wrap"><table id="wp-calendar" class="wp-calendar-table">
	<caption>December 2018</caption>
	<thead>
	<tr>
		<th scope="col" title="Monday">M</th>
		<th scope="col" title="Tuesday">T</th>
		<th scope="col" title="Wednesday">W</th>
		<th scope="col" title="Thursday">T</th>
		<th scope="col" title="Friday">F</th>
		<th scope="col" title="Saturday">S</th>
		<th scope="col" title="Sunday">S</th>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td colspan="5" class="pad">&nbsp;</td><td><a href="https://perl6advent.wordpress.com/2018/12/01/" aria-label="Posts published on December 1, 2018">1</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/02/" aria-label="Posts published on December 2, 2018">2</a></td>
	</tr>
	<tr>
		<td><a href="https://perl6advent.wordpress.com/2018/12/03/" aria-label="Posts published on December 3, 2018">3</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/04/" aria-label="Posts published on December 4, 2018">4</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/05/" aria-label="Posts published on December 5, 2018">5</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/06/" aria-label="Posts published on December 6, 2018">6</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/07/" aria-label="Posts published on December 7, 2018">7</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/08/" aria-label="Posts published on December 8, 2018">8</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/09/" aria-label="Posts published on December 9, 2018">9</a></td>
	</tr>
	<tr>
		<td><a href="https://perl6advent.wordpress.com/2018/12/10/" aria-label="Posts published on December 10, 2018">10</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/11/" aria-label="Posts published on December 11, 2018">11</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/12/" aria-label="Posts published on December 12, 2018">12</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/13/" aria-label="Posts published on December 13, 2018">13</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/14/" aria-label="Posts published on December 14, 2018">14</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/15/" aria-label="Posts published on December 15, 2018">15</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/16/" aria-label="Posts published on December 16, 2018">16</a></td>
	</tr>
	<tr>
		<td><a href="https://perl6advent.wordpress.com/2018/12/17/" aria-label="Posts published on December 17, 2018">17</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/18/" aria-label="Posts published on December 18, 2018">18</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/19/" aria-label="Posts published on December 19, 2018">19</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/20/" aria-label="Posts published on December 20, 2018">20</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/21/" aria-label="Posts published on December 21, 2018">21</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/22/" aria-label="Posts published on December 22, 2018">22</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/23/" aria-label="Posts published on December 23, 2018">23</a></td>
	</tr>
	<tr>
		<td><a href="https://perl6advent.wordpress.com/2018/12/24/" aria-label="Posts published on December 24, 2018">24</a></td><td><a href="https://perl6advent.wordpress.com/2018/12/25/" aria-label="Posts published on December 25, 2018">25</a></td><td>26</td><td>27</td><td>28</td><td>29</td><td>30</td>
	</tr>
	<tr>
		<td>31</td>
		<td class="pad" colspan="6">&nbsp;</td>
	</tr>
	</tbody>
	</table><nav aria-label="Previous and next months" class="wp-calendar-nav">
		<span class="wp-calendar-nav-prev"><a href="https://perl6advent.wordpress.com/2017/12/">&laquo; Dec</a></span>
		<span class="pad">&nbsp;</span>
		<span class="wp-calendar-nav-next"><a href="https://perl6advent.wordpress.com/2019/12/">Dec &raquo;</a></span>
	</nav></div></aside><aside id="archives-8" class="widget widget_archive"><h1 class="widget-title">Archives</h1>
			<ul>
					<li><a href='https://perl6advent.wordpress.com/2019/12/'>December 2019</a></li>
	<li><a href='https://perl6advent.wordpress.com/2018/12/'>December 2018</a></li>
	<li><a href='https://perl6advent.wordpress.com/2017/12/'>December 2017</a></li>
	<li><a href='https://perl6advent.wordpress.com/2016/12/'>December 2016</a></li>
	<li><a href='https://perl6advent.wordpress.com/2016/02/'>February 2016</a></li>
	<li><a href='https://perl6advent.wordpress.com/2015/12/'>December 2015</a></li>
	<li><a href='https://perl6advent.wordpress.com/2015/11/'>November 2015</a></li>
	<li><a href='https://perl6advent.wordpress.com/2014/12/'>December 2014</a></li>
	<li><a href='https://perl6advent.wordpress.com/2013/12/'>December 2013</a></li>
	<li><a href='https://perl6advent.wordpress.com/2013/11/'>November 2013</a></li>
	<li><a href='https://perl6advent.wordpress.com/2012/12/'>December 2012</a></li>
	<li><a href='https://perl6advent.wordpress.com/2011/12/'>December 2011</a></li>
	<li><a href='https://perl6advent.wordpress.com/2010/12/'>December 2010</a></li>
	<li><a href='https://perl6advent.wordpress.com/2009/12/'>December 2009</a></li>
			</ul>

			</aside><aside id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://perl6advent.wordpress.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s">
	</label>
	<input type="submit" class="search-submit" value="Search">
	<span class="genericon genericon-search"></span>
</form>
</aside>			</div><!-- #secondary -->

	</div><!-- #content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
				<div class="site-info">
			<a href="https://wordpress.com/?ref=footer_blog" rel="nofollow">Blog at WordPress.com.</a>
			
					</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<!--  -->
<script src='//0.gravatar.com/js/gprofiles.js?ver=202106y' id='grofiles-cards-js'></script>
<script id='wpgroho-js-extra'>
var WPGroHo = {"my_hash":""};
</script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1610363240h'></script>

	<script>
		// Initialize and attach hovercards to all gravatars
		( function() {
			function init() {
				if ( typeof Gravatar === 'undefined' ) {
					return;
				}

				if ( typeof Gravatar.init !== 'function' ) {
					return;
				}

				Gravatar.profile_cb = function ( hash, id ) {
					WPGroHo.syncProfileData( hash, id );
				};

				Gravatar.my_hash = WPGroHo.my_hash;
				Gravatar.init( 'body', '#wp-admin-bar-my-account' );
			}

			if ( document.readyState !== 'loading' ) {
				init();
			} else {
				document.addEventListener( 'DOMContentLoaded', init );
			}
		} )();
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-0a101160e41fd7fd75f5fc701f8acb1c">
	</div>
	</div>
<script id='highlander-comments-js-extra'>
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/perl6advent.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/perl6advent.wordpress.com\/wp-login.php?action=logout&_wpnonce=1762211b15","homeURL":"https:\/\/perl6advent.wordpress.com\/","postID":"7487","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"","text_direction":"ltr"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1573483029j'></script>

<script>
window.addEventListener( "load", function( event ) {
	var link = document.createElement( "link" );
	link.href = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.css?v=20201002";
	link.type = "text/css";
	link.rel = "stylesheet";
	document.head.appendChild( link );

	var script = document.createElement( "script" );
	script.src = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.js?v=20201002";
	script.defer = true;
	document.body.appendChild( script );
} );
</script>

	
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/perl6advent.wordpress.com\/2018\/12\/22\/day-22-testing-cro-http-apis\/":7487};
	</script>
				<div class="widget widget_eu_cookie_law_widget">
<div
	class="hide-on-button ads-active"
	data-hide-timeout="30"
	data-consent-expiration="180"
	id="eu-cookie-law"
>
	<form method="post">
		<input type="submit" value="Close and accept" class="accept" />

		Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br />
To find out more, including how to control cookies, see here:
				<a href="https://automattic.com/cookies" rel="nofollow">
			Cookie Policy		</a>
 </form>
</div>
</div><script id='sharing-js-js-extra'>
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyNkl1OxDAMhC9EagqIhQfEUVA2dVu3+SN2WpbT40qAxILKPjmK5xtPrMCajUtRMApMDB0u5DC/NRNfwc9WTiwBme2Af3Sn14rl9Fkaigvh+q9sQsnWzaYg0/sv11BN9nWgyOBpRgaFKo42dh7LuVhG1HCQ6xFW8pziNi3ahQYrlOJFcp4pG09xNn1ylU1P33ug6HztlFCZSyGoh6bO/tQEusBccWBXKItZs/I7T12pG1AYsGo3zYTG2xUEQ/ZW8Ox+x8d2mswcbYFgWbDoyUjRbfMeNBMHFHPbXMPLFrpPZS/s9idM7y0V4NEWisNXVeg5PLX37U37eHi4O0wfXAPmfQ=='></script>
<script type='text/javascript'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20200826#ver=20200826' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="//stats.wp.com/w.js?61" defer></script> <script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'10740073','blog_tz':'0','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'10740073','v':'wpcom','tz':'0','user_id':'0','post':'7487','subd':'perl6advent'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1oV0pFNEwueXFaVXlyMGwvVFs4ODlRZi15ODdZbV9dUVlqL1VfcEREP1s4TjU5Yn4/Uk5vakJXb2lxQ3V4N0tka0c5dzFQTDVfYltkY3ZwbmxQQWYtVH5fLE8uc3wtQnB3UUJLL1JQdVRaK0EraklWUXhrUDBEOS5MZEFCfGgyTDV1LE1ITz10VFN1MEk4Q0JfbzROZE9Xd183YmZ3enNDbldLJk1YUVE5TXIvMVprWUFOZ0ktbm9keVtqdz9XZEhzZyYvPyZSaVcsWWo2RkdxNkxPVjZNXzk1dlpVV2RNY1swaUNHY0UlQ2tMUHNMcCZ8YnVFcEY2NjdwdWpDVDIuTEMscDRwTWosW08/eU5uUUY='}]);
_stq.push([ 'clickTrackerInit', '10740073', '7487' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px;" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>
</body>
</html>
