# Since the Hackathon…
    
*Originally published on [2012-05-08](https://6guts.wordpress.com/2012/05/08/since-the-hackathon/) by Jonathan Worthington.*

Last time I got around to writing here was while I was at the Oslo Hackathon. It was a truly great event: hugely productive, a great deal of fun and a real motivation booster too. I’d like to again thank Oslo.pm, and especially `Salve`, `Rune` and `Jan`, for thinking to organize this, and then making a superb job of doing so. Everything ran smoothly, there was lots of undistracted hacking time, and a couple of evening dinner and beer outings provided chance to enjoy time together as a team in real life, without the restricted bandwidth IRC normally enforces on us.

After the hackathon, it was right back to $dayjob, though in a fun way: teaching Git for a couple of days. Less fun was the couple of days after, which involved a lot of pain followed by a lot of noisy drilling at my local dental clinic. It took some days beyond that before I stopped feeling unusually tired… Anyways, things are back to normal again, or as normal as things ever tend to look for me… :-)

So, what’s been going on in Rakudo land since the hackathon? Lots and lots, as it turns out. Most public-facing, the [April 2012 Rakudo Star release](http://rakudo.org/2012/04/26/announce-rakudo-star-2012-04-a-useful-usable-early-adopter-distribution-of-perl-6/) landed; *moritz*++ is to thank for getting the release out of the door this month. It’s the first distribution release to incorporate the bounded serialization work, which delivers the much-improved startup time. While I’ve talked about many of the compiler side improvements in previous posts, Rakudo Star also includes modules, and we had some exciting additions in this release too: `Bailador` (a Raku port of Dancer), `LWP::Simple` and `JSON::RPC`.

Of course, one nice release out the door means time to start working on things to make the next one interesting. Here’s some of what to expect.

- Following on from removing `lib` from the default `@*INC`, the current working directory (`.”) is also gone now. While they may be nice for development, they are not good defaults from a security perspective when you actually run stuff in a production environment. Making this a more comfortable removal, as well as supplying search paths through the `RAKULIB` environment (as has been supported for a long while), the -I command line option and `use lib` have now been implemented, and will be in the next release. *moritz*++ is primarily to thank for this work.
- I realized that now we have `LEAVE` and `UNDO` phasers, I could implement `temp` and `let`. `temp` saves away the current value of a variable, and arranges for that value to be restored when the block is left, so any changes made to it will be undone. `let` is a way of making hypothetical changes to a variable; if the block is left due to an exception or if it evaluates to an undefined value, the change will be rolled back just like `temp`, but a successful completion of the block will leave the value in place. Both are now in place.
- Several days back, *moritz*++ asked me for some inspiration of what to hack on. Amongst my suggestions was working on tagged imports/exports. And sure enough, with me throwing the odd commit in now and then, we have ’em working. Actually the main thing I did was improve the trait handling to support passing the tags to export; some work had been left undone awaiting real serialization, which we now have, so happily it was fairly straightforward to sort things out there.
- *pmichaud*++ has been working on making things better if you build Parrot and Rakudo without ICU. Previously, any case-insensitive string match – even if it didn’t use anything beyond ASCII – would immediately die over a missing ICU. Now you can get away with that.
- A while back I did a first cut implementation of `ff`, the flip-flop operator. It sorta worked, but we missed the `fff` form and, true to form, *masak*++ managed to find a bug to submit too. :-) Today I tossed the previous approach and re-did it, using a state variable for the underlying storage (since I did the first cut at it, the spec was updated to explicitly say that it should be done with a state variable). I also got the `fff` form in place. We now pass the vast majority of spectests for this feature.
- A few days back, *tadzik*++ showed up with a snippet of code that ran insanely slowly. It was doing regex interpolation: `/ <$search_term> /` or the like. Here, if `$search_term` is a string, it will be compiled to a regex and evaluated. Turns out that we weren’t caching that compilation with the string, though. So, if it had to scan or if you backtracked over the `<$search_term>`, then tried it again, you’d end up compiling it every time. A little caching later and things went rather faster. I was happy to have a profiler to hand; the call counts into the compiler very quickly showed what was up.
- Our `END` phasers didn’t always run when you’d hope they did. In the last few days, *moritz*++ ensured they run on exceptional exits, and I made sure they run when execution is terminated using the `exit` function.
- This evening, *kboga*++ showed up with a patch to turn `Real`, which ended up as a class during the early days of the “nom” development branch, into a role as it should be. This enabled custom numeric types. It also enabled us to run real-bridge.t, which brought and extra 200 spectests, pushing us nicely over the 22,000 passing spectests mark.
- In various other fixes: `//=`, `||=` and `&&=` now short-circuit properly, reduction meta-operators on list-associative ops do the right thing (*pmichaud*++), `%*ENV` propagates changes properly (*tadzik*++), `ms//` now works (*moritz*++) and enumeration types can now turn themselves into roles and be composed or mixed in to things.

There’s still over a week before the next compiler release, and I’m sure there will be some more things beyond this. It’s already looking like a nice bunch of improvements, though.

In other news, the work on QAST has also been chugging along. QAST is a replacement for PAST, which is a set of AST nodes together with something that maps them down to POST (Parrot Opcode Syntax Tree), which then becomes PIR code (which Parrot then turns into bytecode and runs). In essence, it’s part of the compiler guts. The not-quite-gone-yet old regex engine aside, PAST is the only significant part of our codebase that is still written in PIR (an assembly-ish language for Parrot). It also predates 6model, bounded serialization and many years of learned lessons. All that said, it gets a lot right, so much will stay the same.

QAST really is a simultaneous port to NQP, leaving out things we came to realize were bad or unrequired, adding much better 6model integration, unifying the notion of “ops” somewhat, improving native type support and taking advantage of native types during its implementation to get the AST nodes more compact, so we can save on memory during the compilation. Additionally, it will unblock *masak*++’s work on quasi splicing in macros, and is a step towards Rakudo targeting other backends being a reality rather than a nice idea. So, lots of win lies ahead…after the hard work of getting it landed. I’m hoping to make some significant steps forward on it during May.

Last but not least, *masak*++ and I will be heading over to the [Bristol IT Megameet](http://www.itmegameet.co.uk/) the weekend after next, giving a 30 minute joint talk on Raku, followed by a couple of hour tutorial. Looking forward to it – and hopefully I’ll be able to sneak a British ale in while I’m over there too. :-)
